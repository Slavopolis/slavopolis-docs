# å¿«é€Ÿä¸Šæ‰‹

åœ¨ç°ä»£å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œç¼“å­˜å·²æˆä¸ºæå‡ç³»ç»Ÿæ€§èƒ½å’Œç”¨æˆ·ä½“éªŒçš„æ ¸å¿ƒç»„ä»¶ã€‚ç„¶è€Œï¼Œä¼ ç»Ÿçš„ Redis æ“ä½œå¾€å¾€éœ€è¦å¤§é‡çš„æ ·æ¿ä»£ç ï¼Œç¼ºä¹ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†å’Œç¼“å­˜ç©¿é€ä¿æŠ¤æœºåˆ¶ã€‚Slavopolis Cache æ¨¡å—æ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›ç—›ç‚¹è€Œè®¾è®¡çš„ä¼ä¸šçº§ç¼“å­˜æŠ½è±¡å±‚ã€‚

ğŸ¯ æ ¸å¿ƒä»·å€¼ï¼š

- **å¼€ç®±å³ç”¨**ï¼šé›¶é…ç½®é›†æˆï¼Œä¾èµ–æ³¨å…¥å³å¯ä½¿ç”¨
- **åŠŸèƒ½å®Œå¤‡**ï¼šæ”¯æŒ Redis æ‰€æœ‰æ•°æ®ç»“æ„çš„ä¸°å¯Œæ“ä½œ
- **ä¼ä¸šçº§ç‰¹æ€§**ï¼šå†…ç½®ç¼“å­˜ç©¿é€ä¿æŠ¤ã€æ‰¹é‡æ“ä½œä¼˜åŒ–ã€å¼‚å¸¸å¤„ç†
- **åˆ†å¸ƒå¼é™æµ**ï¼šå¤šç§é™æµç®—æ³•ï¼Œæ”¯æŒåˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„æµé‡æ§åˆ¶
- **ç±»å‹å®‰å…¨**ï¼šæ³›å‹æ–¹æ³•è®¾è®¡ï¼Œç¼–è¯‘æœŸç±»å‹æ£€æŸ¥
- **é«˜æ€§èƒ½**ï¼šå¤šç§åºåˆ—åŒ–ç­–ç•¥ï¼Œé”®å‰ç¼€ç®¡ç†ï¼Œæ‰¹é‡æ“ä½œä¼˜åŒ–

ğŸ‘¥ é€‚ç”¨äººç¾¤ï¼š

- éœ€è¦å¿«é€Ÿé›†æˆ Redis ç¼“å­˜çš„ Java å¼€å‘è€…
- å¯»æ±‚ä¼ä¸šçº§ç¼“å­˜è§£å†³æ–¹æ¡ˆçš„æŠ€æœ¯å›¢é˜Ÿ
- å¸Œæœ›å‡å°‘ç¼“å­˜ç›¸å…³æ ·æ¿ä»£ç çš„é¡¹ç›®
- éœ€è¦ç»Ÿä¸€ç¼“å­˜æ“ä½œè§„èŒƒçš„å¾®æœåŠ¡æ¶æ„

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä¾èµ–

åœ¨ä½ çš„ Spring Boot é¡¹ç›®çš„ `pom.xml` ä¸­æ·»åŠ  Slavopolis Cache ä¾èµ–ï¼š

```xml
<dependency>
    <groupId>club.slavopolis</groupId>
    <artifactId>slavopolis-cache</artifactId>
    <version>1.0.0-SNAPSHOT</version>
</dependency>
```

### ç¬¬äºŒæ­¥ï¼šé…ç½® Redis è¿æ¥

åœ¨ `application.yml` ä¸­é…ç½® Redis è¿æ¥ä¿¡æ¯ï¼š

```yaml
spring:
  redis:
    host: localhost
    port: 6379
    password: # Redis å¯†ç ï¼ˆå¦‚æœæœ‰ï¼‰
    database: 0
    timeout: 2000ms
    lettuce:
      pool:
        max-active: 10
        max-idle: 8
        min-idle: 2
        max-wait: 2000ms

# Slavopolis Cache é…ç½®
slavopolis:
  cache:
    enabled: true                    # å¯ç”¨ç¼“å­˜æ¨¡å—
    key-prefix: "app"               # ç¼“å­˜é”®å‰ç¼€
    default-expiration: PT1H        # é»˜è®¤è¿‡æœŸæ—¶é—´ï¼ˆ1å°æ—¶ï¼‰
    allow-null-values: true         # å…è®¸ç¼“å­˜ç©ºå€¼
    null-value-expiration: PT5M     # ç©ºå€¼ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆ5åˆ†é’Ÿï¼‰
    serialization: JSON             # åºåˆ—åŒ–ç­–ç•¥
```

### ç¬¬ä¸‰æ­¥ï¼šæ³¨å…¥å¹¶ä½¿ç”¨

åœ¨ä½ çš„ä¸šåŠ¡ç±»ä¸­æ³¨å…¥ `CacheService` å¹¶å¼€å§‹ä½¿ç”¨ï¼š

```java
@Service
public class UserService {
    
    @Autowired
    private CacheService cacheService;
    
    public User getUserById(Long userId) {
        String cacheKey = "user:" + userId;
        
        // å°è¯•ä»ç¼“å­˜è·å–
        User user = cacheService.get(cacheKey, User.class);
        if (user != null) {
            return user;
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“åŠ è½½
        user = userRepository.findById(userId);
        if (user != null) {
            // ç¼“å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œ1å°æ—¶è¿‡æœŸ
            cacheService.set(cacheKey, user, Duration.ofHours(1));
        }
        
        return user;
    }
}
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### é€šç”¨æ“ä½œ

#### é”®ç®¡ç†

```java
// æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
boolean exists = cacheService.hasKey("user:123");

// åˆ é™¤å•ä¸ªé”®
boolean deleted = cacheService.delete("user:123");

// æ‰¹é‡åˆ é™¤
Collection<String> keys = Arrays.asList("user:123", "user:456");
long deletedCount = cacheService.delete(keys);

// è®¾ç½®è¿‡æœŸæ—¶é—´
cacheService.expire("user:123", Duration.ofHours(2));

// è·å–è¿‡æœŸæ—¶é—´
long ttl = cacheService.getExpire("user:123", TimeUnit.SECONDS);

// ç§»é™¤è¿‡æœŸæ—¶é—´ï¼ˆæŒä¹…åŒ–ï¼‰
cacheService.persist("user:123");

// æŸ¥æ‰¾åŒ¹é…çš„é”®
Set<String> matchedKeys = cacheService.keys("user:*");

// é‡å‘½åé”®
cacheService.rename("old_key", "new_key");
```

### å­—ç¬¦ä¸²æ“ä½œ

#### åŸºç¡€æ“ä½œ

```java
// è®¾ç½®å€¼
cacheService.set("counter", 100);

// è®¾ç½®å€¼å¹¶æŒ‡å®šè¿‡æœŸæ—¶é—´
cacheService.set("session:abc", userSession, Duration.ofMinutes(30));

// æ¡ä»¶è®¾ç½®ï¼ˆé”®ä¸å­˜åœ¨æ—¶æ‰è®¾ç½®ï¼‰
boolean set = cacheService.setIfAbsent("lock:resource", "locked");

// æ¡ä»¶è®¾ç½®ï¼ˆé”®å­˜åœ¨æ—¶æ‰è®¾ç½®ï¼‰
boolean updated = cacheService.setIfPresent("config:theme", "dark");

// è·å–å€¼
Integer counter = cacheService.get("counter");

// è·å–å¹¶è®¾ç½®æ–°å€¼
Integer oldValue = cacheService.getAndSet("counter", 200);
```

#### æ‰¹é‡æ“ä½œ

```java
// æ‰¹é‡è®¾ç½®
Map<String, Object> batch = new HashMap<>();
batch.put("user:123", user1);
batch.put("user:456", user2);
cacheService.multiSet(batch);

// æ‰¹é‡è·å–
List<String> keys = Arrays.asList("user:123", "user:456");
List<Object> values = cacheService.multiGet(keys);
```

#### æ•°å€¼æ“ä½œ

```java
// è‡ªå¢ï¼ˆé»˜è®¤å¢åŠ 1ï¼‰
long newValue = cacheService.increment("page_views");

// è‡ªå¢æŒ‡å®šæ•°å€¼
long incremented = cacheService.increment("score", 10);

// æµ®ç‚¹æ•°è‡ªå¢
double newScore = cacheService.increment("rating", 0.5);

// è‡ªå‡
long decremented = cacheService.decrement("inventory", 5);
```

### å“ˆå¸Œæ“ä½œ

Hash æ•°æ®ç»“æ„éå¸¸é€‚åˆå­˜å‚¨å¯¹è±¡çš„å¤šä¸ªå±æ€§ï¼š

```java
// è®¾ç½®å“ˆå¸Œå­—æ®µ
cacheService.hSet("user:123", "name", "å¼ ä¸‰");
cacheService.hSet("user:123", "age", 25);

// æ‰¹é‡è®¾ç½®å“ˆå¸Œå­—æ®µ
Map<String, Object> userInfo = new HashMap<>();
userInfo.put("name", "æå››");
userInfo.put("age", 30);
userInfo.put("email", "lisi@example.com");
cacheService.hSetAll("user:456", userInfo);

// æ¡ä»¶è®¾ç½®å“ˆå¸Œå­—æ®µ
boolean fieldSet = cacheService.hSetIfAbsent("user:123", "phone", "13800138000");

// è·å–å“ˆå¸Œå­—æ®µ
String name = cacheService.hGet("user:123", "name");
Integer age = cacheService.hGet("user:123", "age", Integer.class);

// æ‰¹é‡è·å–å“ˆå¸Œå­—æ®µ
List<String> fields = Arrays.asList("name", "age", "email");
List<Object> values = cacheService.hMultiGet("user:456", fields);

// è·å–æ‰€æœ‰å“ˆå¸Œå­—æ®µ
Map<String, Object> allFields = cacheService.hGetAll("user:123");

// æ£€æŸ¥å“ˆå¸Œå­—æ®µæ˜¯å¦å­˜åœ¨
boolean hasField = cacheService.hExists("user:123", "phone");

// åˆ é™¤å“ˆå¸Œå­—æ®µ
long deletedFields = cacheService.hDelete("user:123", "phone", "address");

// è·å–å“ˆå¸Œå¤§å°
long fieldCount = cacheService.hSize("user:123");

// è·å–æ‰€æœ‰å­—æ®µå
Set<String> fieldNames = cacheService.hKeys("user:123");

// è·å–æ‰€æœ‰å­—æ®µå€¼
List<Object> fieldValues = cacheService.hValues("user:123");

// å“ˆå¸Œå­—æ®µæ•°å€¼æ“ä½œ
long newAge = cacheService.hIncrement("user:123", "age", 1);
double newRating = cacheService.hIncrement("user:123", "rating", 0.1);
```

### åˆ—è¡¨æ“ä½œ

List æ•°æ®ç»“æ„é€‚åˆå®ç°é˜Ÿåˆ—ã€æ ˆã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰åœºæ™¯ï¼š

```java
// å·¦ä¾§æ¨å…¥å…ƒç´ 
long size = cacheService.lLeftPush("queue:tasks", "task1", "task2", "task3");

// å³ä¾§æ¨å…¥å…ƒç´ 
cacheService.lRightPush("queue:logs", "log1", "log2");

// å·¦ä¾§å¼¹å‡ºå…ƒç´ ï¼ˆæ ˆæ“ä½œï¼‰
String task = cacheService.lLeftPop("queue:tasks");

// å³ä¾§å¼¹å‡ºå…ƒç´ ï¼ˆé˜Ÿåˆ—æ“ä½œï¼‰
String log = cacheService.lRightPop("queue:logs");

// é˜»å¡å¼¹å‡ºï¼ˆç­‰å¾…å…ƒç´ ï¼Œè¶…æ—¶è¿”å›nullï¼‰
String blockedTask = cacheService.lBlockingLeftPop("queue:tasks", 10, TimeUnit.SECONDS);

// è·å–åˆ—è¡¨èŒƒå›´
List<String> tasks = cacheService.lRange("queue:tasks", 0, -1); // è·å–æ‰€æœ‰å…ƒç´ 
List<String> firstFive = cacheService.lRange("queue:tasks", 0, 4); // è·å–å‰5ä¸ª

// è·å–æŒ‡å®šç´¢å¼•å…ƒç´ 
String firstTask = cacheService.lIndex("queue:tasks", 0);

// è®¾ç½®æŒ‡å®šç´¢å¼•å…ƒç´ 
cacheService.lSet("queue:tasks", 0, "updated_task");

// è·å–åˆ—è¡¨é•¿åº¦
long listSize = cacheService.lSize("queue:tasks");

// ç§»é™¤å…ƒç´ 
long removedCount = cacheService.lRemove("queue:tasks", 0, "task_to_remove");

// è£å‰ªåˆ—è¡¨ï¼ˆä¿ç•™æŒ‡å®šèŒƒå›´ï¼‰
cacheService.lTrim("queue:tasks", 0, 99); // åªä¿ç•™å‰100ä¸ªå…ƒç´ 
```

### é›†åˆæ“ä½œ

Set æ•°æ®ç»“æ„é€‚åˆå»é‡ã€äº¤é›†ã€å¹¶é›†ç­‰åœºæ™¯ï¼š

```java
// æ·»åŠ é›†åˆå…ƒç´ 
long addedCount = cacheService.sAdd("tags:article:123", "Java", "Spring", "Redis");

// ç§»é™¤é›†åˆå…ƒç´ 
long removedCount = cacheService.sRemove("tags:article:123", "Redis");

// æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
boolean isMember = cacheService.sIsMember("tags:article:123", "Java");

// è·å–æ‰€æœ‰é›†åˆæˆå‘˜
Set<String> allTags = cacheService.sMembers("tags:article:123");

// è·å–é›†åˆå¤§å°
long setSize = cacheService.sSize("tags:article:123");

// éšæœºè·å–ä¸€ä¸ªæˆå‘˜
String randomTag = cacheService.sRandomMember("tags:article:123");

// éšæœºè·å–å¤šä¸ªæˆå‘˜
List<String> randomTags = cacheService.sRandomMembers("tags:article:123", 2);

// å¼¹å‡ºä¸€ä¸ªæˆå‘˜
String poppedTag = cacheService.sPop("tags:article:123");

// é›†åˆäº¤é›†
Collection<String> keys = Arrays.asList("tags:article:123", "tags:article:456");
Set<String> intersection = cacheService.sIntersect(keys);

// é›†åˆå¹¶é›†
Set<String> union = cacheService.sUnion(keys);

// é›†åˆå·®é›†
Set<String> difference = cacheService.sDifference("tags:article:123", 
                                                  Arrays.asList("tags:article:456"));
```

### æœ‰åºé›†åˆæ“ä½œ

Sorted Set æ•°æ®ç»“æ„é€‚åˆæ’è¡Œæ¦œã€ä¼˜å…ˆé˜Ÿåˆ—ç­‰åœºæ™¯ï¼š

```java
// æ·»åŠ æœ‰åºé›†åˆå…ƒç´ 
boolean added = cacheService.zAdd("leaderboard", "player1", 100.0);

// æ‰¹é‡æ·»åŠ 
Map<Object, Double> scoreMap = new HashMap<>();
scoreMap.put("player2", 200.0);
scoreMap.put("player3", 150.0);
long addedCount = cacheService.zAdd("leaderboard", scoreMap);

// ç§»é™¤å…ƒç´ 
long removedCount = cacheService.zRemove("leaderboard", "player1");

// è·å–å…ƒç´ åˆ†æ•°
Double score = cacheService.zScore("leaderboard", "player2");

// è·å–å…ƒç´ æ’åï¼ˆä»0å¼€å§‹ï¼Œåˆ†æ•°ä»å°åˆ°å¤§ï¼‰
Long rank = cacheService.zRank("leaderboard", "player2");

// è·å–å…ƒç´ é€†åºæ’åï¼ˆåˆ†æ•°ä»å¤§åˆ°å°ï¼‰
Long reverseRank = cacheService.zReverseRank("leaderboard", "player2");

// è·å–æ’åèŒƒå›´å†…çš„å…ƒç´ 
Set<String> topPlayers = cacheService.zRange("leaderboard", 0, 9); // å‰10å

// è·å–é€†åºæ’åèŒƒå›´å†…çš„å…ƒç´ 
Set<String> topPlayersDesc = cacheService.zReverseRange("leaderboard", 0, 9);

// æ ¹æ®åˆ†æ•°èŒƒå›´è·å–å…ƒç´ 
Set<String> highScorers = cacheService.zRangeByScore("leaderboard", 150.0, 300.0);

// æ ¹æ®åˆ†æ•°èŒƒå›´è·å–å…ƒç´ ï¼ˆå¸¦åˆ†é¡µï¼‰
Set<String> pagedResults = cacheService.zRangeByScore("leaderboard", 0, 1000, 10, 20);

// è·å–æœ‰åºé›†åˆå¤§å°
long zsetSize = cacheService.zSize("leaderboard");

// ç»Ÿè®¡åˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ æ•°é‡
long count = cacheService.zCount("leaderboard", 100.0, 200.0);

// å¢åŠ å…ƒç´ åˆ†æ•°
double newScore = cacheService.zIncrementScore("leaderboard", "player2", 50.0);
```

## ğŸ›¡ï¸ é«˜çº§ç‰¹æ€§

### ç¼“å­˜ç©¿é€ä¿æŠ¤

`getOrLoad` æ–¹æ³•æä¾›äº†å¼ºå¤§çš„ç¼“å­˜ç©¿é€ä¿æŠ¤æœºåˆ¶ï¼š

```java
@Service
public class ProductService {
    
    @Autowired
    private CacheService cacheService;
    
    @Autowired
    private ProductRepository productRepository;
    
    public Product getProduct(Long productId) {
        String cacheKey = "product:" + productId;
        
        // ä½¿ç”¨ getOrLoad æ–¹æ³•ï¼Œè‡ªåŠ¨å¤„ç†ç¼“å­˜ç©¿é€
        return cacheService.getOrLoad(cacheKey, key -> {
            // åªæœ‰ç¼“å­˜ä¸å­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œè¿™ä¸ªåŠ è½½å‡½æ•°
            return productRepository.findById(productId).orElse(null);
        }, Duration.ofHours(1));
    }
    
    // æŒ‡å®šè¿”å›ç±»å‹çš„ç‰ˆæœ¬
    public Product getProductWithType(Long productId) {
        String cacheKey = "product:" + productId;
        
        return cacheService.getOrLoad(cacheKey, Product.class, key -> {
            return productRepository.findById(productId).orElse(null);
        }, Duration.ofHours(1));
    }
}
```

### æ‰¹é‡ç¼“å­˜æ“ä½œ

å¯¹äºéœ€è¦æ‰¹é‡å¤„ç†çš„åœºæ™¯ï¼Œæä¾›äº†é«˜æ•ˆçš„æ‰¹é‡æ“ä½œï¼š

```java
@Service
public class UserService {
    
    @Autowired
    private CacheService cacheService;
    
    @Autowired
    private UserRepository userRepository;
    
    public Map<String, User> getUsers(List<Long> userIds) {
        // æ„å»ºç¼“å­˜é”®åˆ—è¡¨
        List<String> cacheKeys = userIds.stream()
                .map(id -> "user:" + id)
                .collect(Collectors.toList());
        
        // æ‰¹é‡è·å–æˆ–åŠ è½½
        return cacheService.batchGetOrLoad(cacheKeys, missedKeys -> {
            // åªæœ‰ç¼“å­˜æœªå‘½ä¸­çš„é”®æ‰ä¼šæ‰§è¡Œè¿™ä¸ªåŠ è½½å‡½æ•°
            List<Long> missedIds = missedKeys.stream()
                    .map(key -> Long.parseLong(key.substring(5))) // ç§»é™¤ "user:" å‰ç¼€
                    .collect(Collectors.toList());
            
            List<User> users = userRepository.findAllById(missedIds);
            
            // è¿”å›é”®å€¼å¯¹æ˜ å°„
            return users.stream()
                    .collect(Collectors.toMap(
                            user -> "user:" + user.getId(),
                            user -> user
                    ));
        }, Duration.ofHours(1));
    }
}
```

### ç¼“å­˜åˆ·æ–°

å¼ºåˆ¶åˆ·æ–°ç¼“å­˜æ•°æ®ï¼š

```java
public void refreshUserCache(Long userId) {
    String cacheKey = "user:" + userId;
    
    // åˆ é™¤ç°æœ‰ç¼“å­˜å¹¶é‡æ–°åŠ è½½
    User user = cacheService.refresh(cacheKey, key -> {
        return userRepository.findById(userId).orElse(null);
    }, Duration.ofHours(1));
}
```

## ğŸš¦ åˆ†å¸ƒå¼é™æµ

Slavopolis Cache æä¾›äº†å¼ºå¤§çš„åˆ†å¸ƒå¼é™æµåŠŸèƒ½ï¼Œæ”¯æŒå¤šç§é™æµç®—æ³•ï¼Œé€‚ç”¨äº API é™æµã€èµ„æºä¿æŠ¤ã€æµé‡æ§åˆ¶ç­‰åœºæ™¯ã€‚

### é™æµæœåŠ¡æ³¨å…¥

```java
@Service
public class ApiService {
    
    @Autowired
    private RateLimitService rateLimitService;
    
    // ä¸šåŠ¡æ–¹æ³•...
}
```

### æ»‘åŠ¨çª—å£é™æµ

æ»‘åŠ¨çª—å£é™æµæ˜¯æœ€å¸¸ç”¨çš„é™æµç®—æ³•ï¼Œé€‚åˆå¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ï¼š

```java
@RestController
public class ApiController {
    
    @Autowired
    private RateLimitService rateLimitService;
    
    @GetMapping("/api/data")
    public ResponseEntity<String> getData(HttpServletRequest request) {
        String clientIp = getClientIp(request);
        String limitKey = "api:data:" + clientIp;
        
        // æ¯åˆ†é’Ÿæœ€å¤š100æ¬¡è¯·æ±‚
        RateLimitResult result = rateLimitService.slidingWindowLimit(
            limitKey, 
            Duration.ofMinutes(1), 
            100, 
            1
        );
        
        if (!result.isAllowed()) {
            return ResponseEntity.status(429)
                .header("X-RateLimit-Remaining", "0")
                .header("X-RateLimit-Reset", result.getResetTime().toString())
                .body("è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•");
        }
        
        // è®¾ç½®å“åº”å¤´
        return ResponseEntity.ok()
            .header("X-RateLimit-Remaining", String.valueOf(result.getRemainingQuota()))
            .body("APIå“åº”æ•°æ®");
    }
}
```

### ä»¤ç‰Œæ¡¶é™æµ

ä»¤ç‰Œæ¡¶é™æµé€‚åˆéœ€è¦å¤„ç†çªå‘æµé‡çš„åœºæ™¯ï¼š

```java
@Service
public class EmailService {
    
    @Autowired
    private RateLimitService rateLimitService;
    
    public boolean sendEmail(String userId, String email) {
        String limitKey = "email:send:" + userId;
        
        // æ¡¶å®¹é‡10ï¼Œæ¯ç§’è¡¥å……2ä¸ªä»¤ç‰Œ
        RateLimitResult result = rateLimitService.tokenBucketLimit(
            limitKey, 
            10,     // æ¡¶å®¹é‡
            2,      // è¡¥å……é€Ÿç‡ï¼ˆä»¤ç‰Œ/ç§’ï¼‰
            1       // è¯·æ±‚ä»¤ç‰Œæ•°
        );
        
        if (!result.isAllowed()) {
            log.warn("ç”¨æˆ· {} å‘é€é‚®ä»¶è¢«é™æµï¼Œå‰©ä½™é…é¢: {}", userId, result.getRemainingQuota());
            return false;
        }
        
        // æ‰§è¡Œå‘é€é‚®ä»¶é€»è¾‘
        return doSendEmail(email);
    }
}
```

### å›ºå®šçª—å£é™æµ

å›ºå®šçª—å£é™æµå®ç°ç®€å•ï¼Œé€‚åˆå¯¹ç²¾ç¡®åº¦è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼š

```java
@Service
public class DownloadService {
    
    @Autowired
    private RateLimitService rateLimitService;
    
    public boolean downloadFile(String userId, String fileId) {
        String limitKey = "download:" + userId;
        
        // æ¯å°æ—¶æœ€å¤šä¸‹è½½50ä¸ªæ–‡ä»¶
        RateLimitResult result = rateLimitService.fixedWindowLimit(
            limitKey,
            Duration.ofHours(1),
            50,
            1
        );
        
        if (!result.isAllowed()) {
            throw new BusinessException("ä¸‹è½½æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œè¯·ç¨åå†è¯•");
        }
        
        return doDownload(fileId);
    }
}
```

### æ¼æ¡¶é™æµ

æ¼æ¡¶é™æµä¸¥æ ¼æŒ‰ç…§å›ºå®šé€Ÿç‡å¤„ç†è¯·æ±‚ï¼Œé€‚åˆéœ€è¦å¹³æ»‘æµé‡çš„åœºæ™¯ï¼š

```java
@Service
public class MessageService {
    
    @Autowired
    private RateLimitService rateLimitService;
    
    public void processMessage(String message) {
        String limitKey = "message:process";
        
        // æ¡¶å®¹é‡100ï¼Œæ¯ç§’å¤„ç†10æ¡æ¶ˆæ¯
        RateLimitResult result = rateLimitService.leakyBucketLimit(
            limitKey,
            100,    // æ¡¶å®¹é‡
            10,     // å¤„ç†é€Ÿç‡ï¼ˆæ¶ˆæ¯/ç§’ï¼‰
            1       // æœ¬æ¬¡æ¶ˆæ¯æ•°
        );
        
        if (!result.isAllowed()) {
            // æ¶ˆæ¯è¢«ä¸¢å¼ƒæˆ–æ”¾å…¥å»¶è¿Ÿé˜Ÿåˆ—
            log.warn("æ¶ˆæ¯å¤„ç†è¢«é™æµï¼Œæ¶ˆæ¯: {}", message);
            return;
        }
        
        doProcessMessage(message);
    }
}
```

### åŸºäºè§„åˆ™çš„é™æµ

æ”¯æŒå¤šç»´åº¦ã€å¤šè§„åˆ™ç»„åˆé™æµï¼š

```java
@Service
public class OrderService {
    
    @Autowired
    private RateLimitService rateLimitService;
    
    public boolean createOrder(String userId, Order order) {
        String limitKey = "order:create:" + userId;
        
        // å®šä¹‰å¤šä¸ªé™æµè§„åˆ™
        List<RateLimitRule> rules = Arrays.asList(
            // æ¯åˆ†é’Ÿæœ€å¤š5ä¸ªè®¢å•
            RateLimitRule.builder()
                .name("minute-limit")
                .algorithm(RateLimitAlgorithm.SLIDING_WINDOW)
                .windowSize(Duration.ofMinutes(1))
                .maxRequests(5)
                .priority(1)
                .enabled(true)
                .build(),
            
            // æ¯å°æ—¶æœ€å¤š50ä¸ªè®¢å•
            RateLimitRule.builder()
                .name("hour-limit")
                .algorithm(RateLimitAlgorithm.SLIDING_WINDOW)
                .windowSize(Duration.ofHours(1))
                .maxRequests(50)
                .priority(2)
                .enabled(true)
                .build()
        );
        
        RateLimitResult result = rateLimitService.ruleBasedLimit(limitKey, rules, 1);
        
        if (!result.isAllowed()) {
            log.warn("ç”¨æˆ· {} åˆ›å»ºè®¢å•è¢«é™æµ: {}", userId, result.getReason());
            return false;
        }
        
        return doCreateOrder(order);
    }
}
```

### åˆ†å¸ƒå¼é™æµ

åœ¨å¤šå®ä¾‹éƒ¨ç½²åœºæ™¯ä¸‹ï¼Œä½¿ç”¨åˆ†å¸ƒå¼é™æµç¡®ä¿å…¨å±€é™æµæ•ˆæœï¼š

```java
@Service
public class GlobalApiService {
    
    @Autowired
    private RateLimitService rateLimitService;
    
    private final String instanceId = InetAddress.getLocalHost().getHostName();
    
    public ResponseEntity<String> handleGlobalApi(String apiKey) {
        String limitKey = "global:api:" + apiKey;
        
        // å…¨å±€æ¯åˆ†é’Ÿ1000æ¬¡è¯·æ±‚
        RateLimitResult result = rateLimitService.distributedSlidingWindowLimit(
            limitKey,
            Duration.ofMinutes(1),
            1000,
            1,
            instanceId
        );
        
        if (!result.isAllowed()) {
            Map<String, Object> metadata = result.getMetadata();
            log.info("å…¨å±€é™æµè§¦å‘ - å…¨å±€é…é¢: {}, å®ä¾‹é…é¢: {}", 
                    metadata.get("globalQuota"), 
                    metadata.get("instanceQuota"));
            
            return ResponseEntity.status(429).body("å…¨å±€è¯·æ±‚é¢‘ç‡è¿‡é«˜");
        }
        
        return ResponseEntity.ok("APIå¤„ç†æˆåŠŸ");
    }
}
```

### é™æµç®¡ç†

æä¾›é™æµçŠ¶æ€æŸ¥è¯¢å’Œç®¡ç†åŠŸèƒ½ï¼š

```java
@RestController
@RequestMapping("/admin/rate-limit")
public class RateLimitController {
    
    @Autowired
    private RateLimitService rateLimitService;
    
    @GetMapping("/status/{key}")
    public Map<String, Object> getLimitStatus(@PathVariable String key) {
        return rateLimitService.getLimitStatus(key);
    }
    
    @GetMapping("/quota/{key}")
    public long getRemainingQuota(@PathVariable String key) {
        return rateLimitService.getRemainingQuota(key, Duration.ofMinutes(1), 100);
    }
    
    @PostMapping("/reset/{key}")
    public boolean resetLimit(@PathVariable String key) {
        return rateLimitService.resetLimit(key);
    }
    
    @GetMapping("/metrics/{key}")
    public Map<String, Object> getLimitMetrics(@PathVariable String key) {
        return rateLimitService.getLimitMetrics(key);
    }
}
```

### é™æµé¢„çƒ­

ç³»ç»Ÿå¯åŠ¨æ—¶çš„é™æµé¢„çƒ­æœºåˆ¶ï¼š

```java
@Service
public class WarmupService {
    
    @Autowired
    private RateLimitService rateLimitService;
    
    public long getWarmupThreshold(String service) {
        String limitKey = "warmup:" + service;
        
        // é¢„çƒ­5åˆ†é’Ÿï¼Œå†·å¯åŠ¨å› å­3.0
        return rateLimitService.warmUpLimit(
            limitKey,
            Duration.ofMinutes(5),
            3.0
        );
    }
}
```

## âš™ï¸ é…ç½®è¯¦è§£

### å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
slavopolis:
  cache:
    # åŸºç¡€é…ç½®
    enabled: true                           # æ˜¯å¦å¯ç”¨ç¼“å­˜æ¨¡å—ï¼Œé»˜è®¤ï¼štrue
    key-prefix: "myapp"                    # ç¼“å­˜é”®å‰ç¼€ï¼Œé»˜è®¤ï¼šapp
    
    # è¿‡æœŸæ—¶é—´é…ç½®
    default-expiration: PT2H                # é»˜è®¤è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤ï¼šPT1Hï¼ˆ1å°æ—¶ï¼‰
    allow-null-values: true                 # æ˜¯å¦å…è®¸ç¼“å­˜ç©ºå€¼ï¼Œé»˜è®¤ï¼štrue
    null-value-expiration: PT10M            # ç©ºå€¼ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤ï¼šPT5Mï¼ˆ5åˆ†é’Ÿï¼‰
    
    # åºåˆ—åŒ–é…ç½®
    serialization: JSON                     # åºåˆ—åŒ–ç­–ç•¥ï¼šJSON/JDK/FASTJSON2ï¼Œé»˜è®¤ï¼šJSON
    
    # é”®ç®¡ç†é…ç½®
    key-max-length: 250                     # é”®æœ€å¤§é•¿åº¦ï¼Œé»˜è®¤ï¼š250
    key-hash-threshold: 200                 # é”®é•¿åº¦å“ˆå¸Œé˜ˆå€¼ï¼Œé»˜è®¤ï¼š200
    
    # æ€§èƒ½ä¼˜åŒ–é…ç½®
    batch-size: 1000                        # æ‰¹é‡æ“ä½œå¤§å°ï¼Œé»˜è®¤ï¼š1000
    connection-timeout: PT2S                # è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ï¼šPT2Sï¼ˆ2ç§’ï¼‰
```

### ç¯å¢ƒç‰¹å®šé…ç½®

```yaml
# application-dev.ymlï¼ˆå¼€å‘ç¯å¢ƒï¼‰
slavopolis:
  cache:
    enabled: true
    key-prefix: "dev-myapp"
    default-expiration: PT30M               # å¼€å‘ç¯å¢ƒçŸ­è¿‡æœŸæ—¶é—´
    allow-null-values: true

---
# application-prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
slavopolis:
  cache:
    enabled: true
    key-prefix: "prod-myapp"
    default-expiration: PT4H                # ç”Ÿäº§ç¯å¢ƒé•¿è¿‡æœŸæ—¶é—´
    allow-null-values: false                # ç”Ÿäº§ç¯å¢ƒä¸ç¼“å­˜ç©ºå€¼
    serialization: JSON
```

## ğŸ¯ å®æˆ˜åœºæ™¯

### åœºæ™¯ä¸€ï¼šç”¨æˆ·ä¼šè¯ç®¡ç†

```java
@Service
public class SessionService {
    
    @Autowired
    private CacheService cacheService;
    
    private static final Duration SESSION_TIMEOUT = Duration.ofMinutes(30);
    
    public void createSession(String sessionId, UserSession session) {
        String key = "session:" + sessionId;
        cacheService.set(key, session, SESSION_TIMEOUT);
    }
    
    public UserSession getSession(String sessionId) {
        String key = "session:" + sessionId;
        return cacheService.get(key, UserSession.class);
    }
    
    public void refreshSession(String sessionId) {
        String key = "session:" + sessionId;
        if (cacheService.hasKey(key)) {
            cacheService.expire(key, SESSION_TIMEOUT);
        }
    }
    
    public void destroySession(String sessionId) {
        String key = "session:" + sessionId;
        cacheService.delete(key);
    }
}
```

### åœºæ™¯äºŒï¼šåˆ†å¸ƒå¼è®¡æ•°å™¨

```java
@Service
public class CounterService {
    
    @Autowired
    private CacheService cacheService;
    
    public long incrementPageView(String pageId) {
        String key = "page_view:" + pageId;
        return cacheService.increment(key);
    }
    
    public long getPageViewCount(String pageId) {
        String key = "page_view:" + pageId;
        Integer count = cacheService.get(key, Integer.class);
        return count != null ? count : 0;
    }
    
    public Map<String, Long> getBatchPageViews(List<String> pageIds) {
        List<String> keys = pageIds.stream()
                .map(id -> "page_view:" + id)
                .collect(Collectors.toList());
        
        List<Object> values = cacheService.multiGet(keys);
        
        Map<String, Long> result = new HashMap<>();
        for (int i = 0; i < pageIds.size(); i++) {
            Object value = values.get(i);
            long count = value != null ? ((Number) value).longValue() : 0;
            result.put(pageIds.get(i), count);
        }
        
        return result;
    }
}
```

### åœºæ™¯ä¸‰ï¼šå®æ—¶æ’è¡Œæ¦œ

```java
@Service
public class LeaderboardService {
    
    @Autowired
    private CacheService cacheService;
    
    private static final String LEADERBOARD_KEY = "game:leaderboard";
    
    public void updateScore(String playerId, double score) {
        cacheService.zAdd(LEADERBOARD_KEY, playerId, score);
    }
    
    public void addScore(String playerId, double delta) {
        cacheService.zIncrementScore(LEADERBOARD_KEY, playerId, delta);
    }
    
    public List<PlayerRank> getTopPlayers(int count) {
        Set<String> topPlayers = cacheService.zReverseRange(LEADERBOARD_KEY, 0, count - 1);
        
        return topPlayers.stream()
                .map(playerId -> {
                    Double score = cacheService.zScore(LEADERBOARD_KEY, playerId);
                    Long rank = cacheService.zReverseRank(LEADERBOARD_KEY, playerId);
                    return new PlayerRank(playerId, score, rank + 1); // æ’åä»1å¼€å§‹
                })
                .collect(Collectors.toList());
    }
    
    public PlayerRank getPlayerRank(String playerId) {
        Double score = cacheService.zScore(LEADERBOARD_KEY, playerId);
        if (score == null) {
            return null;
        }
        
        Long rank = cacheService.zReverseRank(LEADERBOARD_KEY, playerId);
        return new PlayerRank(playerId, score, rank + 1);
    }
}
```

### åœºæ™¯å››ï¼šçƒ­ç‚¹æ•°æ®ç¼“å­˜

```java
@Service
public class ArticleService {
    
    @Autowired
    private CacheService cacheService;
    
    @Autowired
    private ArticleRepository articleRepository;
    
    public Article getHotArticle(Long articleId) {
        String cacheKey = "hot:article:" + articleId;
        
        // çƒ­ç‚¹æ–‡ç« ç¼“å­˜æ—¶é—´è¾ƒé•¿
        return cacheService.getOrLoad(cacheKey, key -> {
            return articleRepository.findById(articleId).orElse(null);
        }, Duration.ofHours(4));
    }
    
    public List<Article> getHotArticles(List<Long> articleIds) {
        List<String> cacheKeys = articleIds.stream()
                .map(id -> "hot:article:" + id)
                .collect(Collectors.toList());
        
        Map<String, Article> cachedArticles = cacheService.batchGetOrLoad(
                cacheKeys,
                missedKeys -> {
                    List<Long> missedIds = missedKeys.stream()
                            .map(key -> Long.parseLong(key.substring(12))) // ç§»é™¤å‰ç¼€
                            .collect(Collectors.toList());
                    
                    List<Article> articles = articleRepository.findAllById(missedIds);
                    return articles.stream()
                            .collect(Collectors.toMap(
                                    article -> "hot:article:" + article.getId(),
                                    article -> article
                            ));
                },
                Duration.ofHours(4)
        );
        
        return articleIds.stream()
                .map(id -> cachedArticles.get("hot:article:" + id))
                .filter(Objects::nonNull)
                .collect(Collectors.toList());
    }
}
```

### åœºæ™¯äº”ï¼šAPIé™æµä¿æŠ¤

```java
@RestController
@RequestMapping("/api/v1")
public class PublicApiController {
    
    @Autowired
    private RateLimitService rateLimitService;
    
    @Autowired
    private UserService userService;
    
    /**
     * ç”¨æˆ·æ³¨å†Œæ¥å£ - ä½¿ç”¨æ»‘åŠ¨çª—å£é™æµ
     */
    @PostMapping("/register")
    public ResponseEntity<ApiResponse> register(@RequestBody RegisterRequest request, 
                                              HttpServletRequest httpRequest) {
        String clientIp = getClientIp(httpRequest);
        String limitKey = "register:" + clientIp;
        
        // æ¯å°æ—¶æœ€å¤šæ³¨å†Œ5æ¬¡
        RateLimitResult result = rateLimitService.slidingWindowLimit(
            limitKey, 
            Duration.ofHours(1), 
            5, 
            1
        );
        
        if (!result.isAllowed()) {
            return ResponseEntity.status(429)
                .header("X-RateLimit-Remaining", "0")
                .header("X-RateLimit-Reset", result.getResetTime().toString())
                .body(ApiResponse.error("æ³¨å†Œè¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"));
        }
        
        // æ‰§è¡Œæ³¨å†Œé€»è¾‘
        User user = userService.register(request);
        
        return ResponseEntity.ok()
            .header("X-RateLimit-Remaining", String.valueOf(result.getRemainingQuota()))
            .body(ApiResponse.success(user));
    }
    
    /**
     * å‘é€éªŒè¯ç æ¥å£ - ä½¿ç”¨ä»¤ç‰Œæ¡¶é™æµ
     */
    @PostMapping("/send-code")
    public ResponseEntity<ApiResponse> sendVerificationCode(@RequestBody SendCodeRequest request) {
        String limitKey = "send_code:" + request.getPhone();
        
        // æ¡¶å®¹é‡5ï¼Œæ¯åˆ†é’Ÿè¡¥å……1ä¸ªä»¤ç‰Œ
        RateLimitResult result = rateLimitService.tokenBucketLimit(
            limitKey, 
            5,      // æ¡¶å®¹é‡
            1,      // æ¯åˆ†é’Ÿè¡¥å……1ä¸ªä»¤ç‰Œ
            1       // è¯·æ±‚1ä¸ªä»¤ç‰Œ
        );
        
        if (!result.isAllowed()) {
            return ResponseEntity.status(429)
                .body(ApiResponse.error("éªŒè¯ç å‘é€è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"));
        }
        
        // å‘é€éªŒè¯ç 
        boolean sent = smsService.sendCode(request.getPhone());
        
        return ResponseEntity.ok(ApiResponse.success("éªŒè¯ç å‘é€æˆåŠŸ"));
    }
    
    /**
     * æ–‡ä»¶ä¸Šä¼ æ¥å£ - ä½¿ç”¨åŸºäºè§„åˆ™çš„é™æµ
     */
    @PostMapping("/upload")
    public ResponseEntity<ApiResponse> uploadFile(@RequestParam("file") MultipartFile file,
                                                 @RequestParam("userId") String userId) {
        String limitKey = "upload:" + userId;
        
        // å®šä¹‰å¤šå±‚é™æµè§„åˆ™
        List<RateLimitRule> rules = Arrays.asList(
            // æ¯åˆ†é’Ÿæœ€å¤šä¸Šä¼ 3ä¸ªæ–‡ä»¶
            RateLimitRule.builder()
                .name("minute-limit")
                .algorithm(RateLimitAlgorithm.SLIDING_WINDOW)
                .windowSize(Duration.ofMinutes(1))
                .maxRequests(3)
                .priority(1)
                .enabled(true)
                .build(),
            
            // æ¯å°æ—¶æœ€å¤šä¸Šä¼ 20ä¸ªæ–‡ä»¶
            RateLimitRule.builder()
                .name("hour-limit")
                .algorithm(RateLimitAlgorithm.SLIDING_WINDOW)
                .windowSize(Duration.ofHours(1))
                .maxRequests(20)
                .priority(2)
                .enabled(true)
                .build(),
            
            // æ¯å¤©æœ€å¤šä¸Šä¼ 100ä¸ªæ–‡ä»¶
            RateLimitRule.builder()
                .name("day-limit")
                .algorithm(RateLimitAlgorithm.SLIDING_WINDOW)
                .windowSize(Duration.ofDays(1))
                .maxRequests(100)
                .priority(3)
                .enabled(true)
                .build()
        );
        
        RateLimitResult result = rateLimitService.ruleBasedLimit(limitKey, rules, 1);
        
        if (!result.isAllowed()) {
            return ResponseEntity.status(429)
                .body(ApiResponse.error("æ–‡ä»¶ä¸Šä¼ é¢‘ç‡è¶…é™: " + result.getReason()));
        }
        
        // æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ 
        String fileUrl = fileService.upload(file, userId);
        
        return ResponseEntity.ok(ApiResponse.success(fileUrl));
    }
    
    /**
     * æœç´¢æ¥å£ - ä½¿ç”¨æ¼æ¡¶é™æµ
     */
    @GetMapping("/search")
    public ResponseEntity<ApiResponse> search(@RequestParam("keyword") String keyword,
                                            HttpServletRequest request) {
        String clientIp = getClientIp(request);
        String limitKey = "search:" + clientIp;
        
        // æ¡¶å®¹é‡20ï¼Œæ¯ç§’å¤„ç†2ä¸ªè¯·æ±‚
        RateLimitResult result = rateLimitService.leakyBucketLimit(
            limitKey,
            20,     // æ¡¶å®¹é‡
            2,      // æ¯ç§’å¤„ç†2ä¸ªè¯·æ±‚
            1       // æœ¬æ¬¡è¯·æ±‚æ•°
        );
        
        if (!result.isAllowed()) {
            return ResponseEntity.status(429)
                .body(ApiResponse.error("æœç´¢è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"));
        }
        
        // æ‰§è¡Œæœç´¢
        List<SearchResult> results = searchService.search(keyword);
        
        return ResponseEntity.ok(ApiResponse.success(results));
    }
    
    /**
     * è·å–å®¢æˆ·ç«¯IPåœ°å€
     */
    private String getClientIp(HttpServletRequest request) {
        String xForwardedFor = request.getHeader("X-Forwarded-For");
        if (StringUtils.hasText(xForwardedFor)) {
            return xForwardedFor.split(",")[0].trim();
        }
        
        String xRealIp = request.getHeader("X-Real-IP");
        if (StringUtils.hasText(xRealIp)) {
            return xRealIp;
        }
        
        return request.getRemoteAddr();
    }
}
```

## ğŸ” ç›‘æ§ä¸è°ƒè¯•

### æ—¥å¿—é…ç½®

åœ¨ `application.yml` ä¸­é…ç½®æ—¥å¿—çº§åˆ«ï¼š

```yaml
logging:
  level:
    club.slavopolis.cache: DEBUG           # å¼€å¯ç¼“å­˜æ¨¡å—è°ƒè¯•æ—¥å¿—
    org.springframework.data.redis: INFO   # Redis æ“ä½œæ—¥å¿—
```

### å¸¸è§é—®é¢˜æ’æŸ¥

#### 1. ç¼“å­˜æœªå‘½ä¸­é—®é¢˜

```java
// æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
boolean exists = cacheService.hasKey("your:key");
if (!exists) {
    log.warn("ç¼“å­˜é”®ä¸å­˜åœ¨: your:key");
}

// æ£€æŸ¥é”®çš„ç±»å‹
String type = cacheService.type("your:key");
log.info("ç¼“å­˜é”®ç±»å‹: {}", type);

// æŸ¥çœ‹åŒ¹é…çš„é”®
Set<String> keys = cacheService.keys("your:*");
log.info("åŒ¹é…çš„é”®: {}", keys);
```

#### 2. åºåˆ—åŒ–é—®é¢˜

ç¡®ä¿è¢«ç¼“å­˜çš„å¯¹è±¡å®ç°äº† `Serializable` æ¥å£æˆ–èƒ½è¢« JSON åºåˆ—åŒ–ï¼š

```java
// é”™è¯¯ç¤ºä¾‹ï¼šåŒ…å«æ— æ³•åºåˆ—åŒ–çš„å­—æ®µ
public class User {
    private String name;
    private transient HttpServletRequest request; // è¿™ä¸ªå­—æ®µæ— æ³•åºåˆ—åŒ–
}

// æ­£ç¡®ç¤ºä¾‹ï¼šæ‰€æœ‰å­—æ®µéƒ½å¯åºåˆ—åŒ–
public class User implements Serializable {
    private String name;
    private Integer age;
    private LocalDateTime createTime;
}
```

#### 3. è¿‡æœŸæ—¶é—´é—®é¢˜

```java
// æ£€æŸ¥å‰©ä½™è¿‡æœŸæ—¶é—´
long ttl = cacheService.getExpire("your:key", TimeUnit.SECONDS);
if (ttl == -1) {
    log.info("é”®æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´");
} else if (ttl == -2) {
    log.info("é”®ä¸å­˜åœ¨");
} else {
    log.info("é”®å°†åœ¨ {} ç§’åè¿‡æœŸ", ttl);
}
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

### æ€§èƒ½å»ºè®®

1. **åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´**ï¼šé¿å…ç¼“å­˜å ç”¨è¿‡å¤šå†…å­˜
2. **ä½¿ç”¨æ‰¹é‡æ“ä½œ**ï¼šæ‰¹é‡æ“ä½œæ¯”å¾ªç¯å•ä¸ªæ“ä½œæ€§èƒ½æ›´å¥½
3. **é”®å‘½åè§„èŒƒ**ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„é”®åï¼Œä¾¿äºç®¡ç†å’Œè°ƒè¯•
4. **æ§åˆ¶å€¼å¤§å°**ï¼šé¿å…ç¼“å­˜è¿‡å¤§çš„å¯¹è±¡

### çº¿ç¨‹å®‰å…¨

Slavopolis Cache çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨ä½¿ç”¨ã€‚

### äº‹åŠ¡æ”¯æŒ

ç¼“å­˜æ“ä½œé»˜è®¤æ”¯æŒ Spring äº‹åŠ¡ï¼Œä½†éœ€è¦æ³¨æ„ï¼š

```java
@Transactional
public void updateUserWithCache(User user) {
    // æ•°æ®åº“æ“ä½œ
    userRepository.save(user);
    
    // ç¼“å­˜æ“ä½œä¼šåœ¨äº‹åŠ¡æäº¤åæ‰§è¡Œ
    cacheService.set("user:" + user.getId(), user, Duration.ofHours(1));
}
```

## ğŸ“ æ€»ç»“

Slavopolis Cache æ¨¡å—æä¾›äº†å®Œæ•´çš„ Redis ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼Œå…·å¤‡ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- âœ… **ç®€å•æ˜“ç”¨**ï¼šæ³¨å…¥å³ç”¨ï¼Œæ— éœ€å¤æ‚é…ç½®
- âœ… **åŠŸèƒ½å®Œæ•´**ï¼šæ”¯æŒ Redis æ‰€æœ‰æ•°æ®ç»“æ„
- âœ… **ä¼ä¸šçº§ç‰¹æ€§**ï¼šç¼“å­˜ç©¿é€ä¿æŠ¤ã€æ‰¹é‡æ“ä½œã€å¼‚å¸¸å¤„ç†
- âœ… **é«˜æ€§èƒ½**ï¼šå¤šç§ä¼˜åŒ–ç­–ç•¥ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯
- âœ… **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒè‡ªå®šä¹‰é…ç½®å’Œæ‰©å±•

é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ å·²ç»æŒæ¡äº† Slavopolis Cache çš„æ ¸å¿ƒåŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç¼“å­˜ç­–ç•¥å’Œæ•°æ®ç»“æ„ï¼Œå°±èƒ½å……åˆ†å‘æŒ¥ç¼“å­˜çš„å¨åŠ›ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚

## ğŸ“š å»¶ä¼¸é˜…è¯»

- [æŠ€æœ¯è§£æ.md](./æŠ€æœ¯è§£æ.md) - æ·±å…¥äº†è§£ Slavopolis Cache çš„è®¾è®¡æ€è·¯å’ŒæŠ€æœ¯æ¶æ„
- [Redis å®˜æ–¹æ–‡æ¡£](https://redis.io/documentation) - Redis è¯¦ç»†ä½¿ç”¨è¯´æ˜
- [Spring Data Redis æ–‡æ¡£](https://docs.spring.io/spring-data/redis/docs/current/reference/html/) - Spring Redis é›†æˆæŒ‡å— 
