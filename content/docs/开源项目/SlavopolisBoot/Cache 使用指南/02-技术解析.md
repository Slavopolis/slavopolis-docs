# æŠ€æœ¯è§£æ

åœ¨ä¼ä¸šçº§åº”ç”¨å¼€å‘ä¸­ï¼Œç¼“å­˜ç³»ç»Ÿçš„è®¾è®¡å¾€å¾€éœ€è¦åœ¨æ€§èƒ½ã€å¯ç»´æŠ¤æ€§ã€æ‰©å±•æ€§å’Œä¸šåŠ¡éœ€æ±‚ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚Slavopolis Cache æ¨¡å—ä½œä¸ºä¸€ä¸ªé¢å‘ä¼ä¸šåœºæ™¯çš„ Redis ç¼“å­˜æŠ½è±¡å±‚ï¼Œå…¶è®¾è®¡å“²å­¦ä½“ç°äº†å¯¹è¿™ä¸€å¹³è¡¡çš„æ·±åº¦æ€è€ƒã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æ Slavopolis Cache çš„æŠ€æœ¯æ¶æ„ã€è®¾è®¡å†³ç­–å’Œå®ç°ç»†èŠ‚ï¼Œå¸®åŠ©è¯»è€…ç†è§£å…¶èƒŒåçš„å·¥ç¨‹æ™ºæ…§ï¼Œå¹¶ä¸ºç±»ä¼¼ç³»ç»Ÿçš„è®¾è®¡æä¾›å‚è€ƒã€‚

ğŸ¯ è®¾è®¡ç›®æ ‡ï¼š

- **é«˜åº¦æŠ½è±¡**ï¼šå±è”½åº•å±‚ Redis æ“ä½œå¤æ‚æ€§ï¼Œæä¾›ç»Ÿä¸€çš„ç¼–ç¨‹æ¥å£
- **ä¼ä¸šçº§ç‰¹æ€§**ï¼šå†…ç½®ç¼“å­˜ç©¿é€ä¿æŠ¤ã€å¼‚å¸¸å¤„ç†ã€ç›‘æ§ç­‰ç”Ÿäº§çº§åŠŸèƒ½
- **åˆ†å¸ƒå¼é™æµ**ï¼šåŸºäº Redis çš„å¤šç®—æ³•é™æµå®ç°ï¼Œæ”¯æŒåˆ†å¸ƒå¼åœºæ™¯
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæ‰¹é‡æ“ä½œã€è¿æ¥å¤ç”¨ã€åºåˆ—åŒ–ä¼˜åŒ–ç­‰æ€§èƒ½ç­–ç•¥
- **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒè‡ªå®šä¹‰æ‰©å±•å’Œé…ç½®
- **Spring ç”Ÿæ€é›†æˆ**ï¼šæ— ç¼é›†æˆ Spring Boot è‡ªåŠ¨é…ç½®æœºåˆ¶

ğŸ“ æ¶æ„åŸåˆ™ï¼š

1. **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šé…ç½®ã€æœåŠ¡ã€å·¥å…·å„å¸å…¶èŒ
2. **ä¾èµ–å€’ç½®**ï¼šé¢å‘æ¥å£ç¼–ç¨‹ï¼Œé™ä½è€¦åˆåº¦
3. **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­
4. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç»„ä»¶ä¸“æ³¨ç‰¹å®šèŒè´£
5. **æœ€å°æƒŠè®¶åŸåˆ™**ï¼šAPI è®¾è®¡ç¬¦åˆå¼€å‘è€…ç›´è§‰

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å…¨è§ˆ

```mermaid
graph TB
    A["ä¸šåŠ¡åº”ç”¨å±‚"] --> B["CacheService æ¥å£"]
    A --> B2["RateLimitService æ¥å£"]
    B --> C["CacheServiceImpl å®ç°"]
    B2 --> C2["RateLimitServiceImpl å®ç°"]
    C --> D["RedisTemplate æŠ½è±¡å±‚"]
    C2 --> D
    C2 --> LS["LuaScriptService"]
    D --> E["Redis è¿æ¥å·¥å‚"]
    E --> F["Redis æœåŠ¡å™¨"]
    
    G["é…ç½®æ¨¡å—"] --> H["CacheProperties"]
    G --> I["RedisAutoConfiguration"]
    G --> J["CacheAutoConfiguration"]
    
    H --> I
    I --> D
    J --> C
    J --> C2
    
    K["å·¥å…·æ¨¡å—"] --> L["CacheKeyUtil"]
    K --> M["CacheException"]
    
    C --> L
    C --> M
    C2 --> L
    C2 --> M
    
    N["åºåˆ—åŒ–ç­–ç•¥"] --> O["JSON åºåˆ—åŒ–"]
    N --> P["JDK åºåˆ—åŒ–"]
    N --> Q["Generic JSON åºåˆ—åŒ–"]
    
    I --> N
    
    R["é™æµç®—æ³•"] --> R1["æ»‘åŠ¨çª—å£"]
    R --> R2["ä»¤ç‰Œæ¡¶"]
    R --> R3["å›ºå®šçª—å£"]
    R --> R4["æ¼æ¡¶"]
    
    C2 --> R
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style B2 fill:#f3e5f5
    style C fill:#fff3e0
    style C2 fill:#fff3e0
    style D fill:#e8f5e8
    style F fill:#ffebee
    style R fill:#e8f5e8
```

### æ¨¡å—åˆ’åˆ†

```mermaid
graph LR
    A["Slavopolis Cache"] --> B["é…ç½®æ¨¡å—<br/>Configuration"]
    A --> C["æœåŠ¡æ¨¡å—<br/>Service"]
    A --> D["å·¥å…·æ¨¡å—<br/>Util"]
    A --> E["å¼‚å¸¸æ¨¡å—<br/>Exception"]
    A --> F["é™æµæ¨¡å—<br/>RateLimit"]
    
    B --> B1["CacheProperties<br/>é…ç½®å±æ€§"]
    B --> B2["RedisAutoConfiguration<br/>Redisè‡ªåŠ¨é…ç½®"]
    B --> B3["CacheAutoConfiguration<br/>ç¼“å­˜è‡ªåŠ¨é…ç½®"]
    
    C --> C1["CacheService<br/>ç¼“å­˜æœåŠ¡æ¥å£"]
    C --> C2["CacheServiceImpl<br/>ç¼“å­˜æœåŠ¡å®ç°"]
    
    D --> D1["CacheKeyUtil<br/>é”®å·¥å…·ç±»"]
    
    E --> E1["CacheException<br/>ç¼“å­˜å¼‚å¸¸"]
    
    F --> F1["RateLimitService<br/>é™æµæœåŠ¡æ¥å£"]
    F --> F2["RateLimitServiceImpl<br/>é™æµæœåŠ¡å®ç°"]
    F --> F3["LuaScriptService<br/>Luaè„šæœ¬æœåŠ¡"]
    F --> F4["RateLimitScripts<br/>é™æµè„šæœ¬åº“"]
    
    style A fill:#fff2cc
    style B fill:#dae8fc
    style C fill:#d5e8d4
    style D fill:#ffe6cc
    style E fill:#f8cecc
    style F fill:#e1d5e7
```

### æ•°æ®æµè½¬å›¾

```mermaid
sequenceDiagram
    participant App as ä¸šåŠ¡åº”ç”¨
    participant CS as CacheService
    participant RT as RedisTemplate
    participant Redis as Redis Server
    participant KU as KeyUtil
    
    App->>CS: è°ƒç”¨ç¼“å­˜æ“ä½œ
    CS->>KU: æ„å»ºç¼“å­˜é”®
    KU-->>CS: è¿”å›å®Œæ•´é”®å
    CS->>RT: æ‰§è¡ŒRedisæ“ä½œ
    RT->>Redis: å‘é€å‘½ä»¤
    Redis-->>RT: è¿”å›ç»“æœ
    RT-->>CS: è¿”å›å“åº”
    CS->>CS: å¤„ç†ç»“æœ(å¼‚å¸¸/ç©ºå€¼)
    CS-->>App: è¿”å›ä¸šåŠ¡æ•°æ®
```

## ğŸ§© æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. æœåŠ¡å±‚è®¾è®¡

#### CacheService æ¥å£è®¾è®¡

```java
public interface CacheService {
    // é€šç”¨æ“ä½œ - 7ä¸ªæ–¹æ³•
    boolean hasKey(String key);
    boolean delete(String key);
    // ... å…¶ä»–é€šç”¨æ–¹æ³•
    
    // å­—ç¬¦ä¸²æ“ä½œ - 12ä¸ªæ–¹æ³•
    void set(String key, Object value);
    <T> T get(String key);
    // ... å…¶ä»–å­—ç¬¦ä¸²æ–¹æ³•
    
    // å“ˆå¸Œæ“ä½œ - 12ä¸ªæ–¹æ³•
    void hSet(String key, String field, Object value);
    <T> T hGet(String key, String field);
    // ... å…¶ä»–å“ˆå¸Œæ–¹æ³•
    
    // åˆ—è¡¨æ“ä½œ - 11ä¸ªæ–¹æ³•
    long lLeftPush(String key, Object... values);
    <T> T lLeftPop(String key);
    // ... å…¶ä»–åˆ—è¡¨æ–¹æ³•
    
    // é›†åˆæ“ä½œ - 10ä¸ªæ–¹æ³•
    long sAdd(String key, Object... values);
    <T> Set<T> sMembers(String key);
    // ... å…¶ä»–é›†åˆæ–¹æ³•
    
    // æœ‰åºé›†åˆæ“ä½œ - 13ä¸ªæ–¹æ³•
    boolean zAdd(String key, Object value, double score);
    <T> Set<T> zRange(String key, long start, long end);
    // ... å…¶ä»–æœ‰åºé›†åˆæ–¹æ³•
    
    // é«˜çº§åŠŸèƒ½ - 3ä¸ªæ–¹æ³•
    <T> T getOrLoad(String key, Function<String, T> loader, Duration duration);
    <T> Map<String, T> batchGetOrLoad(Collection<String> keys, Function<Collection<String>, Map<String, T>> loader, Duration duration);
    <T> T refresh(String key, Function<String, T> loader, Duration duration);
}
```

**è®¾è®¡æ€è·¯**ï¼š

1. **API åˆ†ç»„**ï¼šæŒ‰ Redis æ•°æ®ç»“æ„åˆ†ç»„ï¼Œä¾¿äºç†è§£å’Œä½¿ç”¨
2. **æ³›å‹è®¾è®¡**ï¼šæä¾›ç±»å‹å®‰å…¨çš„æ–¹æ³•é‡è½½
3. **å‡½æ•°å¼ç¼–ç¨‹**ï¼šé«˜çº§åŠŸèƒ½ä½¿ç”¨ Function æ¥å£ï¼Œæ”¯æŒæ‡’åŠ è½½
4. **Duration æ”¯æŒ**ï¼šç°ä»£ Java æ—¶é—´ APIï¼Œæ›¿ä»£ä¼ ç»Ÿçš„ TimeUnit

#### CacheServiceImpl å®ç°æ¶æ„

```mermaid
graph TB
    A["CacheServiceImpl"] --> B["é€šç”¨æ“ä½œå®ç°"]
    A --> C["å­—ç¬¦ä¸²æ“ä½œå®ç°"]
    A --> D["å“ˆå¸Œæ“ä½œå®ç°"]
    A --> E["åˆ—è¡¨æ“ä½œå®ç°"]
    A --> F["é›†åˆæ“ä½œå®ç°"]
    A --> G["æœ‰åºé›†åˆæ“ä½œå®ç°"]
    A --> H["é«˜çº§åŠŸèƒ½å®ç°"]
    
    I["å·¥å…·æ–¹æ³•"] --> I1["buildKey()<br/>é”®æ„å»º"]
    I --> I2["processNullValue()<br/>ç©ºå€¼å¤„ç†"]
    
    J["æ ¸å¿ƒä¾èµ–"] --> J1["RedisTemplate<br/>Redisæ“ä½œ"]
    J --> J2["CacheProperties<br/>é…ç½®å±æ€§"]
    
    A --> I
    A --> J
    
    style A fill:#fff3e0
    style I fill:#e8f5e8
    style J fill:#f3e5f5
```

**å…³é”®å®ç°ç‰¹æ€§**ï¼š

1. **ç»Ÿä¸€å¼‚å¸¸å¤„ç†**ï¼šæ‰€æœ‰æ–¹æ³•éƒ½åŒ…å«å®Œæ•´çš„å¼‚å¸¸å¤„ç†é€»è¾‘
2. **ç©ºå€¼å ä½ç¬¦**ï¼šä½¿ç”¨ `___NULL___` å ä½ç¬¦é˜²æ­¢ç¼“å­˜ç©¿é€
3. **é”®å‰ç¼€ç®¡ç†**ï¼šè‡ªåŠ¨æ·»åŠ å’Œå¤„ç†é”®å‰ç¼€
4. **ç±»å‹å®‰å…¨è½¬æ¢**ï¼šæä¾›æ³›å‹æ–¹æ³•çš„ç±»å‹å®‰å…¨å®ç°

### 2. é…ç½®å±‚è®¾è®¡

#### é…ç½®å±æ€§å±‚æ¬¡ç»“æ„

```mermaid
graph TB
    A["CacheProperties"] --> B["åŸºç¡€é…ç½®"]
    A --> C["è¿‡æœŸæ—¶é—´é…ç½®"]
    A --> D["åºåˆ—åŒ–é…ç½®"]
    A --> E["é”®ç®¡ç†é…ç½®"]
    A --> F["æ€§èƒ½é…ç½®"]
    
    B --> B1["enabled: boolean<br/>å¯ç”¨å¼€å…³"]
    B --> B2["keyPrefix: String<br/>é”®å‰ç¼€"]
    
    C --> C1["defaultExpiration: Duration<br/>é»˜è®¤è¿‡æœŸæ—¶é—´"]
    C --> C2["allowNullValues: boolean<br/>å…è®¸ç©ºå€¼ç¼“å­˜"]
    C --> C3["nullValueExpiration: Duration<br/>ç©ºå€¼è¿‡æœŸæ—¶é—´"]
    
    D --> D1["serialization: SerializationType<br/>åºåˆ—åŒ–ç­–ç•¥"]
    
    E --> E1["keyMaxLength: int<br/>é”®æœ€å¤§é•¿åº¦"]
    E --> E2["keyHashThreshold: int<br/>é”®å“ˆå¸Œé˜ˆå€¼"]
    
    F --> F1["batchSize: int<br/>æ‰¹é‡æ“ä½œå¤§å°"]
    F --> F2["connectionTimeout: Duration<br/>è¿æ¥è¶…æ—¶"]
    
    style A fill:#fff2cc
    style B fill:#dae8fc
    style C fill:#d5e8d4
    style D fill:#ffe6cc
    style E fill:#f8cecc
    style F fill:#e1d5e7
```

#### è‡ªåŠ¨é…ç½®æµç¨‹

```mermaid
sequenceDiagram
    participant SB as Spring Boot
    participant CAC as CacheAutoConfiguration
    participant RAC as RedisAutoConfiguration
    participant CP as CacheProperties
    participant RT as RedisTemplate
    participant CS as CacheService
    
    SB->>CAC: å¯åŠ¨è‡ªåŠ¨é…ç½®
    CAC->>CP: è¯»å–é…ç½®å±æ€§
    CAC->>RAC: åˆå§‹åŒ–Redisé…ç½®
    RAC->>RT: åˆ›å»ºRedisTemplate
    RAC->>RT: é…ç½®åºåˆ—åŒ–å™¨
    CAC->>CS: åˆ›å»ºCacheService
    CS->>RT: æ³¨å…¥RedisTemplate
    CS->>CP: æ³¨å…¥CacheProperties
    CAC-->>SB: é…ç½®å®Œæˆ
```

### 3. å·¥å…·å±‚è®¾è®¡

#### CacheKeyUtil è®¾è®¡

```java
public final class CacheKeyUtil {
    // æ ¸å¿ƒåŠŸèƒ½
    public static String buildKey(String prefix, Object... parts);
    public static String buildPattern(String prefix, Object... parts);
    public static boolean isValidKey(String key);
    
    // æ‰¹é‡å¤„ç†
    public static List<String> buildKeys(String prefix, Collection<?> identifiers);
    
    // é”®è½¬æ¢
    public static String extractBusinessKey(String key, String prefix);
    
    // ç§æœ‰å·¥å…·æ–¹æ³•
    private static String normalizeKeyPart(Object part);
    private static String hashKey(String key);
}
```

**è®¾è®¡ç‰¹æ€§**ï¼š

1. **é™æ€å·¥å…·ç±»**ï¼šä½¿ç”¨ `@NoArgsConstructor(access = AccessLevel.PRIVATE)` é˜²æ­¢å®ä¾‹åŒ–
2. **é”®é•¿åº¦ç®¡ç†**ï¼šè¶…è¿‡é˜ˆå€¼çš„é”®ä¼šè‡ªåŠ¨è¿›è¡Œ MD5 å“ˆå¸Œ
3. **éæ³•å­—ç¬¦å¤„ç†**ï¼šè‡ªåŠ¨å¤„ç†ç©ºæ ¼ã€æ¢è¡Œç­‰éæ³•å­—ç¬¦
4. **æ‰¹é‡æ“ä½œæ”¯æŒ**ï¼šæä¾›æ‰¹é‡é”®æ„å»ºæ–¹æ³•

#### é”®æ„å»ºæµç¨‹

```mermaid
flowchart TD
    A[è¾“å…¥åŸå§‹é”®] --> B{é”®æ˜¯å¦ä¸ºç©º?}
    B -->|æ˜¯| C[æŠ›å‡ºå¼‚å¸¸]
    B -->|å¦| D[æ·»åŠ å‰ç¼€]
    D --> E[ç»„è£…å®Œæ•´é”®]
    E --> F{é”®é•¿åº¦ > é˜ˆå€¼?}
    F -->|æ˜¯| G[MD5å“ˆå¸Œå‹ç¼©]
    F -->|å¦| H[éªŒè¯é”®åˆæ³•æ€§]
    G --> I[è¿”å›å“ˆå¸Œé”®]
    H --> J{åŒ…å«éæ³•å­—ç¬¦?}
    J -->|æ˜¯| K[å­—ç¬¦è§„èŒƒåŒ–]
    J -->|å¦| L[è¿”å›åŸå§‹é”®]
    K --> L
    
    style C fill:#ffcccb
    style I fill:#90ee90
    style L fill:#90ee90
```

## ğŸš€ æ ¸å¿ƒæŠ€æœ¯è§£æ

### 1. ç¼“å­˜ç©¿é€ä¿æŠ¤æœºåˆ¶

#### ç©ºå€¼å ä½ç¬¦ç­–ç•¥

```java
// ç©ºå€¼å ä½ç¬¦å¸¸é‡
private static final String NULL_VALUE_PLACEHOLDER = "___NULL___";

// ç©ºå€¼å¤„ç†æ–¹æ³•
private <T> T processNullValue(Object value) {
    if (NULL_VALUE_PLACEHOLDER.equals(value)) {
        return null;
    }
    return (T) value;
}
```

#### getOrLoad å®ç°æµç¨‹

```mermaid
flowchart TD
    A[getOrLoadè°ƒç”¨] --> B[å°è¯•ä»ç¼“å­˜è·å–]
    B --> C{ç¼“å­˜å‘½ä¸­?}
    C -->|æ˜¯| D[è¿”å›ç¼“å­˜å€¼]
    C -->|å¦| E[æ‰§è¡ŒåŠ è½½å‡½æ•°]
    E --> F{åŠ è½½æˆåŠŸ?}
    F -->|æ˜¯| G[è®¾ç½®ç¼“å­˜]
    F -->|å¦| H{å…è®¸ç©ºå€¼ç¼“å­˜?}
    G --> I[è¿”å›åŠ è½½å€¼]
    H -->|æ˜¯| J[è®¾ç½®ç©ºå€¼å ä½ç¬¦]
    H -->|å¦| K[è¿”å›null]
    J --> L[è®¾ç½®çŸ­è¿‡æœŸæ—¶é—´]
    L --> K
    
    style D fill:#90ee90
    style I fill:#90ee90
    style K fill:#ffcccb
```

**æŠ€æœ¯è¦ç‚¹**ï¼š

1. **ç¼“å­˜ç©¿é€é˜²æŠ¤**ï¼šå¯¹äº null å€¼ï¼Œè®¾ç½®ç‰¹æ®Šå ä½ç¬¦å¹¶ç¼“å­˜è¾ƒçŸ­æ—¶é—´
2. **å¼‚å¸¸é™çº§**ï¼šç¼“å­˜å¼‚å¸¸æ—¶ç›´æ¥è°ƒç”¨åŠ è½½å‡½æ•°ï¼Œä¿è¯ä¸šåŠ¡ä¸ä¸­æ–­
3. **é…ç½®é©±åŠ¨**ï¼šé€šè¿‡ `allowNullValues` æ§åˆ¶æ˜¯å¦ç¼“å­˜ç©ºå€¼

### 2. æ‰¹é‡æ“ä½œä¼˜åŒ–

#### batchGetOrLoad å¤æ‚åº¦ä¼˜åŒ–

**é‡æ„å‰é—®é¢˜**ï¼š
- æ–¹æ³•è®¤çŸ¥å¤æ‚åº¦è¾¾åˆ° 33ï¼Œè¶…è¿‡ SonarQube å»ºè®®çš„ 15
- å•ä¸€æ–¹æ³•æ‰¿æ‹…è¿‡å¤šèŒè´£
- ä»£ç å¯è¯»æ€§å’Œç»´æŠ¤æ€§å·®

**é‡æ„åæ¶æ„**ï¼š

```mermaid
graph TD
    A["batchGetOrLoad<br/>ä¸»æ–¹æ³•"] --> B["identifyMissedKeys<br/>è¯†åˆ«ç¼ºå¤±é”®"]
    A --> C["loadAndCacheMissedData<br/>åŠ è½½ç¼ºå¤±æ•°æ®"]
    
    C --> D["processCacheForLoadedData<br/>å¤„ç†åŠ è½½æ•°æ®ç¼“å­˜"]
    C --> E["handleRemainingMissedKeys<br/>å¤„ç†å‰©ä½™ç¼ºå¤±é”®"]
    
    style A fill:#fff3e0
    style B fill:#e8f5e8
    style C fill:#fff3e0
    style D fill:#e8f5e8
    style E fill:#e8f5e8
```

**ä¼˜åŒ–æ•ˆæœ**ï¼š
- ä¸»æ–¹æ³•å¤æ‚åº¦é™ä½åˆ° 5
- æ¯ä¸ªå­æ–¹æ³•èŒè´£å•ä¸€ï¼Œä¾¿äºæµ‹è¯•
- ä»£ç å¯è¯»æ€§å¤§å¹…æå‡

### 3. åºåˆ—åŒ–ç­–ç•¥è®¾è®¡

#### å¤šç­–ç•¥æ”¯æŒæ¶æ„

```mermaid
graph TB
    A["RedisAutoConfiguration"] --> B["åºåˆ—åŒ–ç­–ç•¥é€‰æ‹©"]
    
    B --> C["JSONåºåˆ—åŒ–<br/>Jackson2JsonRedisSerializer"]
    B --> D["JDKåºåˆ—åŒ–<br/>JdkSerializationRedisSerializer"]
    B --> E["é€šç”¨JSONåºåˆ—åŒ–<br/>GenericJackson2JsonRedisSerializer"]
    
    C --> F["ObjectMapperé…ç½®"]
    F --> G["ç±»å‹ä¿¡æ¯åŒ…å«"]
    F --> H["æ—¶é—´æ¨¡å—æ”¯æŒ"]
    F --> I["æœªçŸ¥å±æ€§å¿½ç•¥"]
    
    style A fill:#fff2cc
    style B fill:#dae8fc
    style C fill:#d5e8d4
    style D fill:#ffe6cc
    style E fill:#f8cecc
```

#### JSON åºåˆ—åŒ–é…ç½®è¯¦è§£

```java
private ObjectMapper createObjectMapper() {
    ObjectMapper objectMapper = new ObjectMapper();
    
    // è®¾ç½®å¯è§æ€§ - æ”¯æŒæ‰€æœ‰å­—æ®µåºåˆ—åŒ–
    objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
    
    // å¯ç”¨ç±»å‹ä¿¡æ¯ - è§£å†³å¤šæ€åºåˆ—åŒ–é—®é¢˜
    objectMapper.activateDefaultTyping(
        LaissezFaireSubTypeValidator.instance,
        ObjectMapper.DefaultTyping.NON_FINAL,
        JsonTypeInfo.As.PROPERTY
    );
    
    // Java 8 æ—¶é—´æ”¯æŒ
    objectMapper.registerModule(new JavaTimeModule());
    objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);
    
    // å®¹é”™é…ç½®
    objectMapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);
    
    return objectMapper;
}
```

**æŠ€æœ¯ç‰¹æ€§**ï¼š

1. **ç±»å‹ä¿¡æ¯ä¿å­˜**ï¼šåºåˆ—åŒ–æ—¶åŒ…å«ç±»å‹ä¿¡æ¯ï¼Œæ”¯æŒå¤šæ€å¯¹è±¡
2. **æ—¶é—´ç±»å‹æ”¯æŒ**ï¼šåŸç”Ÿæ”¯æŒ Java 8 æ—¶é—´ API
3. **å®¹é”™æ€§**ï¼šå¿½ç•¥æœªçŸ¥å±æ€§ï¼Œå¢å¼ºç‰ˆæœ¬å…¼å®¹æ€§
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨é«˜æ•ˆçš„ Jackson åº“

### 4. å¼‚å¸¸å¤„ç†æœºåˆ¶

#### ç»Ÿä¸€å¼‚å¸¸å¤„ç†æ¨¡å¼

```java
public void set(String key, Object value) {
    try {
        String finalKey = buildKey(key);
        redisTemplate.opsForValue().set(finalKey, value);
    } catch (Exception e) {
        log.error("è®¾ç½®ç¼“å­˜å¤±è´¥ï¼Œkey: {}", key, e);
        throw new CacheException("è®¾ç½®ç¼“å­˜å¤±è´¥", e);
    }
}
```

#### å¼‚å¸¸å¤„ç†æµç¨‹

```mermaid
flowchart TD
    A[æ–¹æ³•è°ƒç”¨] --> B[å‚æ•°éªŒè¯]
    B --> C{å‚æ•°æœ‰æ•ˆ?}
    C -->|å¦| D[æŠ›å‡ºIllegalArgumentException]
    C -->|æ˜¯| E[æ‰§è¡ŒRedisæ“ä½œ]
    E --> F{æ“ä½œæˆåŠŸ?}
    F -->|æ˜¯| G[è¿”å›ç»“æœ]
    F -->|å¦| H[è®°å½•é”™è¯¯æ—¥å¿—]
    H --> I[åŒ…è£…ä¸ºCacheException]
    I --> J[æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸]
    
    style G fill:#90ee90
    style D fill:#ffcccb
    style J fill:#ffcccb
```

**è®¾è®¡åŸåˆ™**ï¼š

1. **å¿«é€Ÿå¤±è´¥**ï¼šå‚æ•°é”™è¯¯ç«‹å³æŠ›å‡ºå¼‚å¸¸
2. **å¼‚å¸¸è½¬æ¢**ï¼šå°†åº•å±‚å¼‚å¸¸è½¬æ¢ä¸ºä¸šåŠ¡å¼‚å¸¸
3. **æ—¥å¿—è®°å½•**ï¼šè¯¦ç»†è®°å½•å¼‚å¸¸ä¿¡æ¯ï¼Œä¾¿äºæ’æŸ¥
4. **ä¸Šä¸‹æ–‡ä¿ç•™**ï¼šä¿ç•™åŸå§‹å¼‚å¸¸ä¿¡æ¯

### 5. åˆ†å¸ƒå¼é™æµç³»ç»Ÿ

#### é™æµæ¶æ„è®¾è®¡

```mermaid
graph TB
    A["RateLimitService æ¥å£"] --> B["RateLimitServiceImpl å®ç°"]
    B --> C["LuaScriptService"]
    B --> D["RateLimitScripts"]
    
    C --> E["Redis Lua è„šæœ¬æ‰§è¡Œ"]
    D --> F["é™æµç®—æ³•è„šæœ¬åº“"]
    
    F --> G["æ»‘åŠ¨çª—å£è„šæœ¬"]
    F --> H["ä»¤ç‰Œæ¡¶è„šæœ¬"]
    F --> I["å›ºå®šçª—å£è„šæœ¬"]
    F --> J["æ¼æ¡¶è„šæœ¬"]
    F --> K["åˆ†å¸ƒå¼æ»‘åŠ¨çª—å£è„šæœ¬"]
    
    B --> L["RateLimitResult"]
    L --> M["é™æµç»“æœå°è£…"]
    
    style A fill:#f3e5f5
    style B fill:#fff3e0
    style C fill:#e8f5e8
    style D fill:#e8f5e8
    style L fill:#f0f9ff
```

#### æ ¸å¿ƒé™æµç®—æ³•å®ç°

##### 1. æ»‘åŠ¨çª—å£ç®—æ³•

**ç®—æ³•åŸç†**ï¼š
- ç»´æŠ¤ä¸€ä¸ªæ—¶é—´çª—å£ï¼Œè®°å½•çª—å£å†…çš„è¯·æ±‚æ—¶é—´æˆ³
- æ¯æ¬¡è¯·æ±‚æ—¶æ¸…ç†è¿‡æœŸçš„æ—¶é—´æˆ³ï¼Œæ£€æŸ¥å½“å‰çª—å£å†…è¯·æ±‚æ•°é‡
- ç›¸æ¯”å›ºå®šçª—å£ï¼Œèƒ½æ›´å¹³æ»‘åœ°æ§åˆ¶æµé‡

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š
- **ç²¾ç¡®æ§åˆ¶**ï¼šä¸¥æ ¼æŒ‰ç…§æ—¶é—´çª—å£è®¡ç®—è¯·æ±‚æ•°é‡
- **å†…å­˜ä¼˜åŒ–**ï¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®ï¼Œé¿å…å†…å­˜æ³„æ¼
- **åŸå­æ“ä½œ**ï¼šLua è„šæœ¬ä¿è¯æ“ä½œçš„åŸå­æ€§

##### 2. ä»¤ç‰Œæ¡¶ç®—æ³•

**ç®—æ³•åŸç†**ï¼š
- ä»¥å›ºå®šé€Ÿç‡å‘æ¡¶ä¸­æ·»åŠ ä»¤ç‰Œ
- è¯·æ±‚æ—¶ä»æ¡¶ä¸­æ¶ˆè€—ä»¤ç‰Œ
- æ¡¶æ»¡æ—¶åœæ­¢æ·»åŠ ä»¤ç‰Œï¼Œå…è®¸çªå‘æµé‡

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š
- **çªå‘æ”¯æŒ**ï¼šå…è®¸çŸ­æ—¶é—´å†…çš„æµé‡çªå‘
- **å¹³æ»‘è¡¥å……**ï¼šæŒ‰å›ºå®šé€Ÿç‡è¡¥å……ä»¤ç‰Œ
- **çŠ¶æ€æŒä¹…åŒ–**ï¼šæ¡¶çŠ¶æ€æŒä¹…åŒ–åˆ° Redis

##### 3. åˆ†å¸ƒå¼æ»‘åŠ¨çª—å£ç®—æ³•

**ç®—æ³•åŸç†**ï¼š
- ç»“åˆå…¨å±€é™æµå’Œå®ä¾‹é™æµ
- å…¨å±€çª—å£æ§åˆ¶æ€»ä½“æµé‡
- å®ä¾‹çª—å£é˜²æ­¢å•å®ä¾‹å ç”¨è¿‡å¤šé…é¢

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š
- **å…¨å±€åè°ƒ**ï¼šå¤šå®ä¾‹é—´åè°ƒé™æµ
- **å…¬å¹³åˆ†é…**ï¼šé˜²æ­¢å•å®ä¾‹å ç”¨è¿‡å¤šé…é¢
- **æ•…éšœéš”ç¦»**ï¼šå®ä¾‹æ•…éšœä¸å½±å“å…¶ä»–å®ä¾‹

#### Lua è„šæœ¬æœåŠ¡è®¾è®¡

```java
@Service
public class LuaScriptServiceImpl implements LuaScriptService {
    
    private final RedisTemplate<String, Object> redisTemplate;
    
    /**
     * è„šæœ¬SHAç¼“å­˜
     */
    private final Map<String, String> scriptShaCache = new ConcurrentHashMap<>();
    
    @Override
    public <T> T execute(String script, Class<T> resultType, List<String> keys, Object... args) {
        try {
            return redisTemplate.execute((RedisCallback<T>) connection -> {
                // å°è¯•ä½¿ç”¨ç¼“å­˜çš„SHA
                String sha = scriptShaCache.get(script);
                if (sha != null && existsScript(sha)) {
                    return executeByScriptSha(sha, resultType, keys, args);
                }
                
                // åŠ è½½è„šæœ¬å¹¶ç¼“å­˜SHA
                sha = loadScript(script);
                scriptShaCache.put(script, sha);
                
                return executeByScriptSha(sha, resultType, keys, args);
            });
        } catch (Exception e) {
            log.error("æ‰§è¡ŒLuaè„šæœ¬å¤±è´¥", e);
            throw new CacheException("æ‰§è¡ŒLuaè„šæœ¬å¤±è´¥", e);
        }
    }
}
```

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š
- **è„šæœ¬ç¼“å­˜**ï¼šç¼“å­˜è„šæœ¬SHAï¼Œé¿å…é‡å¤åŠ è½½
- **åŸå­æ‰§è¡Œ**ï¼šLuaè„šæœ¬ä¿è¯æ“ä½œåŸå­æ€§
- **å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•
- **ç±»å‹å®‰å…¨**ï¼šæ³›å‹æ–¹æ³•æä¾›ç±»å‹å®‰å…¨

#### é™æµé¢„çƒ­æœºåˆ¶

é™æµé¢„çƒ­ä½¿ç”¨æŒ‡æ•°å¢é•¿ç®—æ³•ï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨åˆæœŸä½¿ç”¨è¾ƒä½çš„é™æµé˜ˆå€¼ï¼Œéšç€ç³»ç»Ÿè¿è¡Œæ—¶é—´å¢é•¿ï¼Œé€æ¸æå‡åˆ°æ­£å¸¸é˜ˆå€¼ï¼š

```java
// æŒ‡æ•°é¢„çƒ­å…¬å¼ï¼šcoldThreshold + (normalThreshold - coldThreshold) * progress^2
long currentThreshold = Math.round(coldThreshold + 
    (normalThreshold - coldThreshold) * Math.pow(warmupProgress, 2));
```

**é¢„çƒ­ç®—æ³•ç‰¹ç‚¹**ï¼š
- **æŒ‡æ•°å¢é•¿**ï¼šä½¿ç”¨äºŒæ¬¡å‡½æ•°å®ç°å¹³æ»‘çš„é˜ˆå€¼æå‡
- **å†·å¯åŠ¨ä¿æŠ¤**ï¼šç³»ç»Ÿå¯åŠ¨åˆæœŸä½¿ç”¨è¾ƒä½çš„é™æµé˜ˆå€¼
- **å¼‚å¸¸é™çº§**ï¼šè®¡ç®—å¼‚å¸¸æ—¶ä½¿ç”¨ä¿å®ˆé˜ˆå€¼

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. è¿æ¥ç®¡ç†ä¼˜åŒ–

#### è¿æ¥æ± é…ç½®

```yaml
spring:
  redis:
    lettuce:
      pool:
        max-active: 10      # æœ€å¤§æ´»è·ƒè¿æ¥æ•°
        max-idle: 8         # æœ€å¤§ç©ºé—²è¿æ¥æ•°
        min-idle: 2         # æœ€å°ç©ºé—²è¿æ¥æ•°
        max-wait: 2000ms    # æœ€å¤§ç­‰å¾…æ—¶é—´
```

#### è¿æ¥å¤ç”¨ç­–ç•¥

```mermaid
graph LR
    A["ä¸šåŠ¡è¯·æ±‚"] --> B["è¿æ¥æ± "]
    B --> C["ç©ºé—²è¿æ¥"]
    B --> D["æ–°å»ºè¿æ¥"]
    C --> E["Redisæ“ä½œ"]
    D --> E
    E --> F["å½’è¿˜è¿æ¥æ± "]
    
    style B fill:#fff2cc
    style E fill:#d5e8d4
```

### 2. æ‰¹é‡æ“ä½œä¼˜åŒ–

#### Pipeline æ¨¡å¼åº”ç”¨

```java
// æ‰¹é‡è®¾ç½®ä¼˜åŒ–
public void multiSet(Map<String, Object> map) {
    if (CollectionUtils.isEmpty(map)) {
        return;
    }
    
    try {
        Map<String, Object> finalMap = map.entrySet().stream()
                .collect(Collectors.toMap(
                        entry -> buildKey(entry.getKey()),
                        Map.Entry::getValue
                ));
        
        // ä½¿ç”¨Redis Pipeline æ‰¹é‡æ“ä½œ
        redisTemplate.opsForValue().multiSet(finalMap);
    } catch (Exception e) {
        log.error("æ‰¹é‡è®¾ç½®ç¼“å­˜å¤±è´¥", e);
        throw new CacheException("æ‰¹é‡è®¾ç½®ç¼“å­˜å¤±è´¥", e);
    }
}
```

### 3. å†…å­˜ä¼˜åŒ–

#### é”®é•¿åº¦æ§åˆ¶

```java
private static String hashKey(String key) {
    try {
        MessageDigest md = MessageDigest.getInstance(CommonConstants.MD5_ALGORITHM);
        byte[] hashBytes = md.digest(key.getBytes());
        
        StringBuilder sb = new StringBuilder();
        for (byte b : hashBytes) {
            sb.append(String.format("%02x", b));
        }
        
        return sb.toString();
    } catch (NoSuchAlgorithmException e) {
        throw new CacheException("Failed to hash cache key", e);
    }
}
```

#### å†…å­˜ä½¿ç”¨ä¼˜åŒ–ç­–ç•¥

```mermaid
flowchart TD
    A[é”®é•¿åº¦æ£€æŸ¥] --> B{é•¿åº¦ > é˜ˆå€¼?}
    B -->|æ˜¯| C[MD5å“ˆå¸Œ]
    B -->|å¦| D[ç›´æ¥ä½¿ç”¨]
    C --> E[32å­—ç¬¦å“ˆå¸Œé”®]
    D --> F[åŸå§‹é”®]
    
    G[è¿‡æœŸæ—¶é—´è®¾ç½®] --> H[é˜²æ­¢å†…å­˜æ³„æ¼]
    I[ç©ºå€¼ç¼“å­˜] --> J[çŸ­æœŸç¼“å­˜]
    K[æ‰¹é‡æ“ä½œ] --> L[å‡å°‘ç½‘ç»œå¼€é”€]
    
    style E fill:#90ee90
    style F fill:#90ee90
    style H fill:#90ee90
    style J fill:#90ee90
    style L fill:#90ee90
```

## ğŸ” å®‰å…¨æ€§è®¾è®¡

### 1. é”®å®‰å…¨ç­–ç•¥

#### é”®å‰ç¼€éš”ç¦»

```java
public String buildKey(String prefix, Object... parts) {
    if (!StringUtils.hasText(prefix)) {
        throw new IllegalArgumentException("é”®å‰ç¼€ä¸èƒ½ä¸ºç©º");
    }
    
    StringBuilder keyBuilder = new StringBuilder(prefix);
    
    if (parts != null) {
        for (Object part : parts) {
            if (part != null) {
                if (!keyBuilder.isEmpty()) {
                    keyBuilder.append(CommonConstants.CACHE_KEY_SEPARATOR);
                }
                keyBuilder.append(normalizeKeyPart(part));
            }
        }
    }
    
    return keyBuilder.toString();
}
```

#### é”®éªŒè¯æœºåˆ¶

```java
public static boolean isValidKey(String key) {
    if (!StringUtils.hasText(key)) {
        return false;
    }
    
    // æ£€æŸ¥é”®é•¿åº¦
    if (key.length() > MAX_KEY_LENGTH) {
        return false;
    }
    
    // æ£€æŸ¥éæ³•å­—ç¬¦
    return !key.contains(CommonConstants.SPACE) &&
           !key.contains(CommonConstants.NEW_LINE) &&
           !key.contains(CommonConstants.CARRIAGE_RETURN) &&
           !key.contains(CommonConstants.TAB);
}
```

### 2. æ•°æ®å®‰å…¨

#### åºåˆ—åŒ–å®‰å…¨

```java
// ç±»å‹å®‰å…¨çš„ååºåˆ—åŒ–
@SuppressWarnings("unchecked")
public <T> T get(String key, Class<T> type) {
    try {
        Object value = get(key);
        if (value == null) {
            return null;
        }
        
        if (type.isInstance(value)) {
            return (T) value;
        }
        
        // ç±»å‹ä¸åŒ¹é…æ—¶çš„å®‰å…¨å¤„ç†
        log.warn("ç¼“å­˜å€¼ç±»å‹ä¸åŒ¹é…ï¼Œkey: {}, expected: {}, actual: {}", 
                 key, type.getName(), value.getClass().getName());
        return null;
    } catch (Exception e) {
        log.error("è·å–ç¼“å­˜å¤±è´¥ï¼Œkey: {}, type: {}", key, type.getName(), e);
        throw new CacheException("è·å–ç¼“å­˜å¤±è´¥", e);
    }
}
```

## ğŸ“Š ç›‘æ§ä¸å¯è§‚æµ‹æ€§

### 1. æ—¥å¿—ä½“ç³»

#### åˆ†å±‚æ—¥å¿—è®¾è®¡

```mermaid
graph TB
    A["æ—¥å¿—ä½“ç³»"] --> B["DEBUGçº§åˆ«"]
    A --> C["INFOçº§åˆ«"]
    A --> D["WARNçº§åˆ«"]
    A --> E["ERRORçº§åˆ«"]
    
    B --> B1["è¯¦ç»†æ“ä½œæ—¥å¿—<br/>å‚æ•°ã€è¿”å›å€¼"]
    C --> C1["å…³é”®æ“ä½œæ—¥å¿—<br/>åˆå§‹åŒ–ã€é…ç½®"]
    D --> D1["å¼‚å¸¸æƒ…å†µæ—¥å¿—<br/>ç±»å‹ä¸åŒ¹é…ã€é™çº§"]
    E --> E1["é”™è¯¯æ—¥å¿—<br/>å¼‚å¸¸ã€å¤±è´¥æ“ä½œ"]
    
    style A fill:#fff2cc
    style B fill:#e1f5fe
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#ffebee
```

#### æ—¥å¿—é…ç½®ç¤ºä¾‹

```yaml
logging:
  level:
    club.slavopolis.cache: DEBUG
    org.springframework.data.redis: INFO
  pattern:
    file: "[%d{yyyy-MM-dd HH:mm:ss.SSS}] [%thread] %-5level %logger{50} - %msg%n"
```

### 2. æ€§èƒ½ç›‘æ§

#### å…³é”®æŒ‡æ ‡ç›‘æ§

```java
// åœ¨å®é™…å®ç°ä¸­å¯ä»¥æ·»åŠ ç›‘æ§åŸ‹ç‚¹
@Override
public <T> T get(String key) {
    long startTime = System.currentTimeMillis();
    try {
        String finalKey = buildKey(key);
        Object value = redisTemplate.opsForValue().get(finalKey);
        
        // ç›‘æ§åŸ‹ç‚¹ï¼šå‘½ä¸­ç‡ç»Ÿè®¡
        recordCacheHit(key, value != null);
        
        return processNullValue(value);
    } catch (Exception e) {
        // ç›‘æ§åŸ‹ç‚¹ï¼šé”™è¯¯ç‡ç»Ÿè®¡
        recordCacheError(key, e);
        
        log.error("è·å–ç¼“å­˜å¤±è´¥ï¼Œkey: {}", key, e);
        throw new CacheException("è·å–ç¼“å­˜å¤±è´¥", e);
    } finally {
        // ç›‘æ§åŸ‹ç‚¹ï¼šå“åº”æ—¶é—´ç»Ÿè®¡
        long duration = System.currentTimeMillis() - startTime;
        recordCacheLatency(key, duration);
    }
}
```

## ğŸš€ æ‰©å±•æ€§è®¾è®¡

### 1. æ’ä»¶åŒ–æ¶æ„

#### æ‰©å±•ç‚¹è®¾è®¡

```mermaid
graph TB
    A["CacheServiceæ¥å£"] --> B["é»˜è®¤å®ç°<br/>CacheServiceImpl"]
    A --> C["è‡ªå®šä¹‰å®ç°<br/>CustomCacheService"]
    
    D["åºåˆ—åŒ–æ‰©å±•ç‚¹"] --> E["JSONåºåˆ—åŒ–"]
    D --> F["Protobufåºåˆ—åŒ–"]
    D --> G["Avroåºåˆ—åŒ–"]
    
    H["é”®ç­–ç•¥æ‰©å±•ç‚¹"] --> I["å‰ç¼€ç­–ç•¥"]
    H --> J["å“ˆå¸Œç­–ç•¥"]
    H --> K["åŠ å¯†ç­–ç•¥"]
    
    style A fill:#f3e5f5
    style D fill:#e8f5e8
    style H fill:#fff3e0
```

### 2. é…ç½®æ‰©å±•

#### è‡ªå®šä¹‰é…ç½®æ”¯æŒ

```java
@Configuration
@ConditionalOnProperty(prefix = "slavopolis.cache.custom", name = "enabled", havingValue = "true")
public class CustomCacheConfiguration {
    
    @Bean
    @ConditionalOnMissingBean
    public CacheService customCacheService(RedisTemplate<String, Object> redisTemplate, 
                                         CacheProperties cacheProperties) {
        return new CustomCacheServiceImpl(redisTemplate, cacheProperties);
    }
    
    @Bean("customRedisTemplate")
    public RedisTemplate<String, Object> customRedisTemplate(RedisConnectionFactory connectionFactory) {
        // è‡ªå®šä¹‰ RedisTemplate é…ç½®
        return createCustomRedisTemplate(connectionFactory);
    }
}
```

## ğŸ† æœ€ä½³å®è·µæ€»ç»“

### 1. æ¶æ„è®¾è®¡æœ€ä½³å®è·µ

1. **æ¥å£æŠ½è±¡**ï¼šé€šè¿‡æ¥å£å®šä¹‰å¥‘çº¦ï¼Œå®ç°ç±»ä¸“æ³¨å®ç°
2. **é…ç½®å¤–åŒ–**ï¼šæ‰€æœ‰å¯å˜å‚æ•°é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†
3. **å¼‚å¸¸ç»Ÿä¸€**ï¼šå»ºç«‹ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†å’Œè½¬æ¢æœºåˆ¶
4. **æ—¥å¿—è§„èŒƒ**ï¼šåˆ†å±‚æ¬¡ã€æœ‰ç»“æ„çš„æ—¥å¿—è®°å½•
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ‰¹é‡æ“ä½œã€è¿æ¥å¤ç”¨ã€å†…å­˜ç®¡ç†

### 2. ä»£ç è´¨é‡æœ€ä½³å®è·µ

1. **SonarQube è§„èŒƒ**ï¼šä¸¥æ ¼éµå¾ªä»£ç è´¨é‡è§„èŒƒ
2. **è®¤çŸ¥å¤æ‚åº¦æ§åˆ¶**ï¼šå•ä¸€æ–¹æ³•å¤æ‚åº¦ä¸è¶…è¿‡ 15
3. **æ³›å‹å®‰å…¨**ï¼šæä¾›ç±»å‹å®‰å…¨çš„ API è®¾è®¡
4. **ç©ºå€¼å¤„ç†**ï¼šå®Œå–„çš„ null å€¼å¤„ç†æœºåˆ¶
5. **æµ‹è¯•è¦†ç›–**ï¼šæ ¸å¿ƒé€»è¾‘ 80%+ æµ‹è¯•è¦†ç›–ç‡

### 3. ä¼ä¸šçº§ç‰¹æ€§

1. **ç¼“å­˜ç©¿é€ä¿æŠ¤**ï¼šç©ºå€¼å ä½ç¬¦ + çŸ­æœŸç¼“å­˜
2. **åˆ†å¸ƒå¼é™æµ**ï¼šå¤šç®—æ³•é™æµï¼Œæ”¯æŒåˆ†å¸ƒå¼åœºæ™¯
3. **æ•…éšœé™çº§**ï¼šç¼“å­˜å¼‚å¸¸æ—¶ç›´æ¥è°ƒç”¨æ•°æ®æº
4. **ç›‘æ§å‹å¥½**ï¼šä¸°å¯Œçš„æ—¥å¿—å’Œç›‘æ§åŸ‹ç‚¹
5. **é…ç½®çµæ´»**ï¼šæ”¯æŒå¤šç¯å¢ƒé…ç½®
6. **æ‰©å±•æ€§å¼º**ï¼šæ’ä»¶åŒ–æ¶æ„ï¼Œæ˜“äºæ‰©å±•

## ğŸ”® æŠ€æœ¯æ¼”è¿›æ–¹å‘

### 1. åŠŸèƒ½å¢å¼º

```mermaid
graph TB
    A["å½“å‰ç‰ˆæœ¬"] --> B["V2.0è§„åˆ’"]
    
    B --> C["åˆ†å¸ƒå¼é”é›†æˆ"]
    B --> D["ç¼“å­˜é¢„çƒ­æœºåˆ¶"]
    B --> E["å¤šçº§ç¼“å­˜æ”¯æŒ"]
    B --> F["ç¼“å­˜ç»Ÿè®¡åˆ†æ"]
    B --> G["é™æµåŠŸèƒ½å¢å¼º"]
    
    C --> C1["Redisåˆ†å¸ƒå¼é”"]
    C --> C2["Redissoné›†æˆ"]
    
    D --> D1["å¯åŠ¨æ—¶é¢„çƒ­"]
    D --> D2["å®šæ—¶é¢„çƒ­ä»»åŠ¡"]
    
    E --> E1["L1æœ¬åœ°ç¼“å­˜"]
    E --> E2["L2åˆ†å¸ƒå¼ç¼“å­˜"]
    
    F --> F1["å‘½ä¸­ç‡ç»Ÿè®¡"]
    F --> F2["æ€§èƒ½åˆ†ææŠ¥å‘Š"]
    
    G --> G1["è‡ªé€‚åº”é™æµ"]
    G --> G2["é™æµç›‘æ§é¢æ¿"]
    G --> G3["é™æµè§„åˆ™çƒ­æ›´æ–°"]
    G --> G4["å¤šç»´åº¦é™æµ"]
    
    style A fill:#d5e8d4
    style B fill:#fff2cc
    style G fill:#e1d5e7
```

### 2. æ€§èƒ½ä¼˜åŒ–

1. **æœ¬åœ°ç¼“å­˜é›†æˆ**ï¼šL1 + L2 å¤šçº§ç¼“å­˜æ¶æ„
2. **å¼‚æ­¥æ“ä½œæ”¯æŒ**ï¼šå“åº”å¼ç¼–ç¨‹æ¨¡å‹
3. **æ‰¹é‡æ“ä½œä¼˜åŒ–**ï¼šPipeline å’Œ Lua è„šæœ¬
4. **è¿æ¥æ± ä¼˜åŒ–**ï¼šåŠ¨æ€è¿æ¥æ± ç®¡ç†
5. **åºåˆ—åŒ–ä¼˜åŒ–**ï¼šæ”¯æŒæ›´å¤šé«˜æ•ˆåºåˆ—åŒ–åè®®
6. **é™æµæ€§èƒ½ä¼˜åŒ–**ï¼š
   - **è„šæœ¬é¢„ç¼–è¯‘**ï¼šLua è„šæœ¬é¢„ç¼–è¯‘å’Œç¼“å­˜ä¼˜åŒ–
   - **å†…å­˜ä¼˜åŒ–**ï¼šé™æµæ•°æ®ç»“æ„å†…å­˜ä½¿ç”¨ä¼˜åŒ–
   - **æ‰¹é‡é™æµ**ï¼šæ”¯æŒæ‰¹é‡é™æµæ£€æŸ¥ï¼Œå‡å°‘ç½‘ç»œå¼€é”€
   - **æœ¬åœ°é™æµ**ï¼šç»“åˆæœ¬åœ°é™æµå‡å°‘ Redis è®¿é—®

### 3. è¿ç»´å¢å¼º

1. **å¥åº·æ£€æŸ¥**ï¼šRedis è¿æ¥çŠ¶æ€ç›‘æ§
2. **æŒ‡æ ‡æš´éœ²**ï¼šPrometheus æŒ‡æ ‡é›†æˆ
3. **æ•…éšœæ¢å¤**ï¼šè‡ªåŠ¨é‡è¿å’Œæ•…éšœè½¬ç§»
4. **é…ç½®çƒ­æ›´æ–°**ï¼šè¿è¡Œæ—¶é…ç½®å˜æ›´
5. **å¯è§†åŒ–ç•Œé¢**ï¼šç¼“å­˜ç®¡ç†æ§åˆ¶å°
6. **é™æµè¿ç»´åŠŸèƒ½**ï¼š
   - **é™æµç›‘æ§**ï¼šå®æ—¶é™æµçŠ¶æ€ç›‘æ§å’Œå‘Šè­¦
   - **é™æµåˆ†æ**ï¼šé™æµæ•ˆæœåˆ†æå’ŒæŠ¥å‘Šç”Ÿæˆ
   - **åŠ¨æ€è°ƒæ•´**ï¼šè¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´é™æµå‚æ•°
   - **é™æµå®¡è®¡**ï¼šé™æµæ“ä½œå®¡è®¡æ—¥å¿—å’Œè¿½è¸ª

## ğŸ“ æ€»ç»“

Slavopolis Cache æ¨¡å—é€šè¿‡ç²¾å¿ƒçš„æ¶æ„è®¾è®¡å’Œå·¥ç¨‹å®è·µï¼Œä¸ºä¼ä¸šçº§åº”ç”¨æä¾›äº†ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡ã€æ€§èƒ½ä¼˜å¼‚ã€æ˜“äºä½¿ç”¨çš„ Redis ç¼“å­˜æŠ½è±¡å±‚ã€‚å…¶è®¾è®¡å“²å­¦ä½“ç°äº†ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„å¹³è¡¡ï¼š

### ğŸ¯ æŠ€æœ¯ä»·å€¼

1. **æŠ½è±¡æ€§ vs æ€§èƒ½**ï¼šåœ¨æä¾›é«˜åº¦æŠ½è±¡çš„åŒæ—¶ï¼Œä¿æŒäº†æ¥è¿‘åŸç”Ÿ Redis çš„æ€§èƒ½
2. **æ˜“ç”¨æ€§ vs çµæ´»æ€§**ï¼šç®€åŒ–äº† API ä½¿ç”¨ï¼ŒåŒæ—¶ä¿ç•™äº†è¶³å¤Ÿçš„æ‰©å±•ç©ºé—´
3. **åŠŸèƒ½æ€§ vs å¤æ‚åº¦**ï¼šä¸°å¯Œçš„åŠŸèƒ½ç‰¹æ€§ï¼Œä½†ä¿æŒäº†ä»£ç çš„å¯ç»´æŠ¤æ€§
4. **æ ‡å‡†åŒ– vs å®šåˆ¶åŒ–**ï¼šéµå¾ªä¸šç•Œæ ‡å‡†ï¼ŒåŒæ—¶æ”¯æŒä¼ä¸šçº§å®šåˆ¶éœ€æ±‚

### ğŸ”§ å·¥ç¨‹æ™ºæ…§

1. **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šæ¸…æ™°çš„æ¨¡å—åˆ’åˆ†å’ŒèŒè´£è¾¹ç•Œ
2. **é˜²å¾¡å¼ç¼–ç¨‹**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶å¤„ç†
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤šä¸ªå±‚é¢çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
4. **å¯è§‚æµ‹æ€§**ï¼šä¸°å¯Œçš„æ—¥å¿—å’Œç›‘æ§æ”¯æŒ

### ğŸš€ å‘å±•å‰æ™¯

ä½œä¸ºä¸€ä¸ªä¼ä¸šçº§åŸºç¡€è®¾æ–½ç»„ä»¶ï¼ŒSlavopolis Cache å…·æœ‰è‰¯å¥½çš„å‘å±•å‰æ™¯ï¼š

1. **ç”Ÿæ€é›†æˆ**ï¼šä¸ Spring ç”Ÿæ€æ·±åº¦é›†æˆï¼Œç¬¦åˆä¸»æµæŠ€æœ¯è¶‹åŠ¿
2. **æ ‡å‡†éµå¾ª**ï¼šéµå¾ªä¸šç•Œæœ€ä½³å®è·µï¼Œæ˜“äºæ¨å¹¿åº”ç”¨
3. **æ‰©å±•èƒ½åŠ›**ï¼šæ¨¡å—åŒ–æ¶æ„ï¼Œæ”¯æŒæŒç»­æ¼”è¿›
4. **ç¤¾åŒºå‹å¥½**ï¼šå¼€æºå‹å¥½çš„è®¾è®¡ï¼Œä¾¿äºç¤¾åŒºè´¡çŒ®

é€šè¿‡æœ¬æŠ€æœ¯è§£æï¼Œå¸Œæœ›èƒ½å¸®åŠ©è¯»è€…æ·±å…¥ç†è§£ Slavopolis Cache çš„è®¾è®¡æ€è·¯å’Œå®ç°ç»†èŠ‚ï¼Œå¹¶åœ¨ç±»ä¼¼ç³»ç»Ÿçš„è®¾è®¡ä¸­è·å¾—å¯å‘å’Œå‚è€ƒã€‚åœ¨ä¼ä¸šçº§åº”ç”¨å¼€å‘ä¸­ï¼Œè¿™æ ·çš„åŸºç¡€è®¾æ–½ç»„ä»¶å¾€å¾€æ˜¯ç³»ç»Ÿç¨³å®šæ€§å’Œå¼€å‘æ•ˆç‡çš„é‡è¦ä¿éšœã€‚

## ğŸ“š å‚è€ƒèµ„æ–™

- [Redis å®˜æ–¹æ–‡æ¡£](https://redis.io/documentation)
- [Spring Data Redis å‚è€ƒæŒ‡å—](https://docs.spring.io/spring-data/redis/docs/current/reference/html/)
- [Jackson åºåˆ—åŒ–æœ€ä½³å®è·µ](https://github.com/FasterXML/jackson-docs)
- [SonarQube Java è§„åˆ™](https://rules.sonarsource.com/java/)
- [é˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œ](https://github.com/alibaba/p3c) 
